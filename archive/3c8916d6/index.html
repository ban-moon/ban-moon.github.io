<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>Java设计模式详解 | 半月无霜</title><meta name="author" content="半月无霜"><meta name="copyright" content="半月无霜"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="设计模式详解 一、介绍 设计模式（Design pattern）代表了最佳的实践，通常被有经验的面向对象的软件开发人员所采用。设计模式是软件开发人员在软件开发过程中面临的一般问题的解决方案。这些解决方案是众多软件开发人员经过相当长的一段时间的试验和错误总结出来的。 设计模式，就是为了一套对写代码的写法经验的总结，怎么写效率更高，可读性更强，上手更简单。简单的抽象形容，就是摩天大楼和简易茅草屋的区别">
<meta property="og:type" content="article">
<meta property="og:title" content="Java设计模式详解">
<meta property="og:url" content="https://www.banmoon.top/archive/3c8916d6/">
<meta property="og:site_name" content="半月无霜">
<meta property="og:description" content="设计模式详解 一、介绍 设计模式（Design pattern）代表了最佳的实践，通常被有经验的面向对象的软件开发人员所采用。设计模式是软件开发人员在软件开发过程中面临的一般问题的解决方案。这些解决方案是众多软件开发人员经过相当长的一段时间的试验和错误总结出来的。 设计模式，就是为了一套对写代码的写法经验的总结，怎么写效率更高，可读性更强，上手更简单。简单的抽象形容，就是摩天大楼和简易茅草屋的区别">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://banmoon-blog.oss-cn-guangzhou.aliyuncs.com/articles/4c8f1a51096c97b293c78bd3c8b57886.jpg">
<meta property="article:published_time" content="2022-03-02T15:59:09.000Z">
<meta property="article:modified_time" content="2022-04-07T15:38:41.000Z">
<meta property="article:author" content="半月无霜">
<meta property="article:tag" content="demo">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://banmoon-blog.oss-cn-guangzhou.aliyuncs.com/articles/4c8f1a51096c97b293c78bd3c8b57886.jpg"><link rel="shortcut icon" href="https://banmoon-blog.oss-cn-guangzhou.aliyuncs.com/config/favicon.ico"><link rel="canonical" href="https://www.banmoon.top/archive/3c8916d6/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="../../css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: false,
    rightside: true,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Java设计模式详解',
  isPost: true,
  isHome: false,
  isHighlightShrink: undefined,
  isToc: true,
  postUpdate: '2022-04-07 23:38:41'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = url => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      link.onload = () => resolve()
      link.onerror = () => reject()
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/banmoon.css?1" defer /><meta name="generator" content="Hexo 5.4.2"></head><body><link rel="stylesheet" href="/css/flash.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://banmoon-blog.oss-cn-guangzhou.aliyuncs.com/config/a441450a27436ff61f584dc176bc6a10.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="archives/"><div class="headline">文章</div><div class="length-num">76</div></a><a href="tags/"><div class="headline">标签</div><div class="length-num">25</div></a><a href="categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/index"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-fw fas fa-compass"></i><span> 发现</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-fw fa fa-heartbeat"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/picture/"><i class="fa-fw fa-fw fas fa-images"></i><span> 相册</span></a></li><li><a class="site-page child" href="/collection/"><i class="fa-fw fa-fw fas fa-book"></i><span> 收藏</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友联</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://banmoon-blog.oss-cn-guangzhou.aliyuncs.com/articles/4c8f1a51096c97b293c78bd3c8b57886.jpg')"><nav id="nav"><span id="blog-info"><a href="index.html" title="半月无霜"><span class="site-name">半月无霜</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/index"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-fw fas fa-compass"></i><span> 发现</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa-fw fa fa-heartbeat"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/picture/"><i class="fa-fw fa-fw fas fa-images"></i><span> 相册</span></a></li><li><a class="site-page child" href="/collection/"><i class="fa-fw fa-fw fas fa-book"></i><span> 收藏</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友联</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Java设计模式详解</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-03-02T15:59:09.000Z" title="发表于 2022-03-02 23:59:09">2022-03-02</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-04-07T15:38:41.000Z" title="更新于 2022-04-07 23:38:41">2022-04-07</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="../../categories/Java/">Java</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">27.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>112分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Java设计模式详解"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1>设计模式详解</h1>
<h2 id="一、介绍">一、介绍</h2>
<p>设计模式（Design pattern）代表了最佳的实践，通常被有经验的面向对象的软件开发人员所采用。设计模式是软件开发人员在软件开发过程中面临的一般问题的解决方案。这些解决方案是众多软件开发人员经过相当长的一段时间的试验和错误总结出来的。</p>
<p>设计模式，就是为了一套对写代码的写法经验的总结，怎么写效率更高，可读性更强，上手更简单。简单的抽象形容，就是摩天大楼和简易茅草屋的区别，前者使用更大更强的地基，有更加强大的设计蓝图，所以才能高耸入云；而茅草屋，只是简单的材料拼接而成的房子，来一场风可能就塌了。所以程序也是一样，要想做到和摩天大楼一样的程序，设计模式是必不可少的。</p>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220108193628.png" alt="image-20220108193404306" /></p>
<p>大部分人写代码应该都是茅草屋吧，我也是一样。哈哈哈，在写公司的代码时，只想着把功能做出来，常常就忽略的架构上的东西。</p>
<p>本文的绝大部分，都源自于哔哩哔哩尚硅谷学堂，谢谢他们的教程</p>
<h3 id="1）GOF（Gang-of-Four）">1）GOF（Gang of Four）</h3>
<p>GOF，我们通常叫四人帮。在 1994 年，由 Erich Gamma、Richard Helm、Ralph Johnson 和 John Vlissides 四人合著出版了一本名为 <b>Design Patterns - Elements of Reusable Object-Oriented Software（中文译名：设计模式 - 可复用的面向对象软件元素）</b> 的书，该书首次提到了软件开发中设计模式的概念。</p>
<p>一想到如今的我还得学近30年前的知识，我就觉得我好嫩，哈哈哈。</p>
<h3 id="2）七大原则">2）七大原则</h3>
<p>在四人帮的著作中，通过以下7种设计原则，为我们展现了23种设计模式。这7大原则分别是</p>
<ol>
<li class="lvl-3">
<p>单一职责原则</p>
</li>
<li class="lvl-3">
<p>接口隔离原则</p>
</li>
<li class="lvl-3">
<p>依赖倒转原则</p>
</li>
<li class="lvl-3">
<p>里氏替换原则</p>
</li>
<li class="lvl-3">
<p>开闭原则</p>
</li>
<li class="lvl-3">
<p>迪米特原则</p>
</li>
<li class="lvl-3">
<p>合成复用原则</p>
</li>
</ol>
<blockquote>
<p>设计模式到底有几大原则，有人说是五种，有人说6种，而本文列举了七种。对比了一下其他的说法，发现了可以进行组合。具体组合成什么，还请继续往下看</p>
<p>按五大原则划分：1、（2、6）、（3、4）、5、7</p>
<p>按六大原则划分：1、（2、6）、3、4、5、7</p>
</blockquote>
<p>听不懂？没关系，一会通俗的讲解下</p>
<h4 id="2-1）单一职责原则">2.1）单一职责原则</h4>
<p>简单的来说，就是一个类只负责一项职责。如果一个类A负责了两项不同的职责，则要将类的细粒度分解为A1，A2。</p>
<p>常见的场景不好说，比如说一个<code>UserMapper</code>，只进行处理用户相关的职责，而不能处理其他的功能。</p>
<p>别问为什么要这样，问就是强迫症。</p>
<p>但原则是死的，人是活的，自己怎么舒服怎么来，让别人恶心去吧。额，面试的时候可别这样说，还有不要被自己多年前的代码恶心到就行。</p>
<h4 id="2-2）接口隔离原则">2.2）接口隔离原则</h4>
<p>一个类它所实现的接口，这个接口细粒度一定是最低的。这句话很是难懂，使用一个图解来进行描述</p>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220108213936.png" alt="image-20220108213934902" /></p>
<p>简单的图解，上述写法就违背了接口隔离原则,一个接口被类实现，却没有完全实现其接口内的方法。接口隔离原则，一个接口的细粒度需要拉到最低，仅看类需要完全实现的方法，不然不用添加到接口方法中去。</p>
<p>那么上述的代码要怎么改呢，既然类B只需要实现方法01和方法02，我们就创建一个接口给它，同样对应类C；</p>
<p>修改过后的关系</p>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220108214955.png" alt="image-20220108214954153" /></p>
<h4 id="2-3）依赖倒转原则">2.3）依赖倒转原则</h4>
<p>依赖倒转原则，有的翻译又叫依赖倒置原则。本质上他是对面向对象的使用，必须要使用上接口进行编程，将<b>具体的对象抽象化</b>。</p>
<p>在Java中，将对象进行抽象成接口或者抽象类。接口只需要定义规范，具体的实现交给具体的类。我们在进行使用时，都通过对抽象接口或者抽象类进行使用。如此一来，也就实现了高内聚，低耦合的效果。</p>
<p>下面写一段测试代码，效果是一个人接受到邮件，展示一下没有用到依赖倒转原则的效果</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">banmoon</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;半月&quot;</span>);</span><br><span class="line">        banmoon.receive(<span class="keyword">new</span> <span class="title class_">Email</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Email</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getInfo</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;邮件&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receive</span><span class="params">(Email email)</span>&#123;</span><br><span class="line">        System.out.println(<span class="built_in">this</span>.name + <span class="string">&quot;收到了&quot;</span> + email.getInfo());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果就不贴了，挺简单的代码。简单的基础上，进行扩展就有一定的问题了。倘若这个人接受到的不是邮件，而是其他的短信或者微信呢，我们不得再重载<code>receive</code>方法？确实是一条思路，但路子走窄了，这就违背了依赖倒转原则。</p>
<p>我们应该规定一个<code>Email</code>，以及其他消息的抽象接口，看下列优化结果</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">banmoon</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;半月&quot;</span>);</span><br><span class="line">        banmoon.receive(<span class="keyword">new</span> <span class="title class_">Email</span>());</span><br><span class="line">        banmoon.receive(<span class="keyword">new</span> <span class="title class_">Wechat</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Something</span>&#123;</span><br><span class="line">    String <span class="title function_">getInfo</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Email</span> <span class="keyword">implements</span> <span class="title class_">Something</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getInfo</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;邮件&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Wechat</span> <span class="keyword">implements</span> <span class="title class_">Something</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getInfo</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;微信消息&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receive</span><span class="params">(Something sth)</span>&#123;</span><br><span class="line">        System.out.println(<span class="built_in">this</span>.name + <span class="string">&quot;收到了&quot;</span> + sth.getInfo());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果，在进行改进的过程中，原本的<code>main</code>方法都不用改动，效果是嘎嘎的好，后续扩展就很舒服了。</p>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220108231358.png" alt="image-20220108231357159" /></p>
<h4 id="2-4）里氏替换原则">2.4）里氏替换原则</h4>
<p>里氏替换原则，简单的来说是对面向对象语言的继承特性做出的限制。它规定以下几点</p>
<ol>
<li class="lvl-3">
<p>一个类最好来自与继承抽象类或者实现接口，而不是继承一个具体类。具体的类已经是一个完整的个体，不应该进行继承。</p>
</li>
<li class="lvl-3">
<p>如果非要继承，尽量<b>不要重写父类的方法</b>。否则在使用时，会造成方法调用不明确的问题</p>
</li>
</ol>
<p>总的来说，就是<b>不要用继承</b>，尽量不要用。继承会使得类之间增加耦合性，当想修改父类的方法逻辑时，必须要考虑到它的所有子类</p>
<h4 id="2-5）开闭原则">2.5）开闭原则</h4>
<p>开闭原则，是良好程序架构中最基础最重要的设计原则。</p>
<p>简单的来说，对程序的扩展开启，对修改关闭。比如说一个类，当需要新增一个功能时，最好不要影响到原有的方法和属性。原有的功能，能跑就行，只做增强，不做修改，这就是开闭原则。我马上能想到的就是AOP技术，就是对开闭原则最好的诠释。</p>
<p>像其他的原则，本质上都是在遵循开闭原则。</p>
<h4 id="2-6）迪米特原则">2.6）迪米特原则</h4>
<p>迪米特原则，又叫最少知道原则。</p>
<p>它指的是类之间的依赖关系，应当做到最小，细粒度要拉到最小，以减少类之间的耦合度 。</p>
<ol>
<li class="lvl-3">
<p>只和直接朋友类发生依赖</p>
</li>
<li class="lvl-3">
<p>不要依赖其他陌生的类</p>
</li>
</ol>
<blockquote>
<p>直接朋友，当一个类中的使用到其他类，出现的位置在类成员变量，方法参数，方法返回值时。这就说明两个类是直接朋友。</p>
<p>相反的，只在代码块或者方法中出现的类，我们称为陌生的类</p>
</blockquote>
<h4 id="2-7）合成复用原则">2.7）合成复用原则</h4>
<p>合成复用原则，要尽量使用对象聚合和组合，而不是继承关系达到软件复用的目的。</p>
<p>举个例子，类A中的方法1需要使用到类B的方法1和方法2，不应该使用继承，使类A继承类B。这就违背了合成复用原则。</p>
<p>我们可以使用聚合或组合的方式，来进行使用</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>聚合：将类B作为类A的成员属性，再创建一个set方法，在使用类A的方法1前，先使用set方法将类B进行设置</p>
</li>
<li class="lvl-2">
<p>组合：将类B作为类A的成员属性，通过类A的构造方法进行实例化</p>
</li>
</ul>
<h2 id="二、设计模式介绍">二、设计模式介绍</h2>
<p>上面的章节介绍了设计模式的由来，和它的七大设计原则。那么在设计模式的书中，一共列举了23种设计模式，可以分为三大类</p>
<ol>
<li class="lvl-3">
<p><b>创建型模式</b>：单例模式、工厂模式、抽象工厂模式、原型模式、建造者模式</p>
</li>
<li class="lvl-3">
<p><b>结构型模式</b>：适配器模式、桥接模式、装饰模式、组合模式、外观模式、享元模式、代理模式</p>
</li>
<li class="lvl-3">
<p><b>行为型模式</b>：模板方法模式、命令模式、访问者模式、迭代器模式、观察者模式、中介者模式、备忘录模式、解释器模式、状态模式、策略模式、责任链模式</p>
</li>
</ol>
<p>由于设计模式是针对软件程序的代码做出了规范，所以它并不局限于一种语言，本文列举的是Java语言。</p>
<p>其次，设计模式有很多，上文中列举的23种，是前人总结经验得到的，一般都能覆盖程序出现的设计问题。如果您有什么新的设计模式，请让我学习学习。</p>
<h2 id="三、创建型设计模式">三、创建型设计模式</h2>
<h3 id="1）单例模式">1）单例模式</h3>
<p>单例模式，相信大家这这个模式都不陌生，可以说经常听到了。</p>
<p>不过这里还是要讲解一下他的概念，它主要体现在一个类只能有一个实例。</p>
<p>如果其他类想要使用这个类，对不起，你不能直接构造出我的实例，而是只能获取到我有且唯一的一个实例进行使用。</p>
<p>单例模式也可以分为很多种，分别是</p>
<ol>
<li class="lvl-3">
<p>饿汉式（静态常量）</p>
</li>
<li class="lvl-3">
<p>饿汉式（静态代码块）</p>
</li>
<li class="lvl-3">
<p>懒汉式（线程不安全）</p>
</li>
<li class="lvl-3">
<p>懒汉式（线程安全，同步方法）</p>
</li>
<li class="lvl-3">
<p>懒汉式（线程安全，同步代码块）</p>
</li>
<li class="lvl-3">
<p>双重检查</p>
</li>
<li class="lvl-3">
<p>静态内部类</p>
</li>
<li class="lvl-3">
<p>枚举</p>
</li>
</ol>
<blockquote>
<p>单例模式的使用场景</p>
<ul class="lvl-1">
<li class="lvl-2">需要频繁进行创建和销毁，且创建对象时耗时过多或耗费资源过多（重量级对象）</li>
<li class="lvl-2">经常用到的工具类对象、频繁访问数据库或文件的对象（比如数据源、session工厂等）</li>
</ul>
</blockquote>
<h4 id="1-1）饿汉式（静态常量）">1.1）饿汉式（静态常量）</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.singleton;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 饿汉式（静态常量）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton01</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton01</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">Singleton01</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton01</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton01 <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>步骤</p>
<ol>
<li class="lvl-3">
<p>将构造器私有化，这样其他类就不能通过new来创建该类的实例了</p>
</li>
<li class="lvl-3">
<p>写静态常量，并直接给予一个实例</p>
</li>
<li class="lvl-3">
<p>在写一个静态方法，获取上面的静态常量实例</p>
</li>
</ol>
<p>这种方法，是利用了类的加载机制，在Java启动，类装载的时候，进行的实例化，从而达到单例的效果。</p>
<p>在程序中，这个实例会一直伴随着我们，不会被回收，直到服务死亡。如果我们一直没有去使用它，这个实例也一直会存在，从而会造成一定资源的浪费。</p>
<h4 id="1-2）饿汉式（静态代码块）">1.2）饿汉式（静态代码块）</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.singleton;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 饿汉式（静态代码块）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton02</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton02</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton02 instance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        instance = <span class="keyword">new</span> <span class="title class_">Singleton02</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton02 <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对比第一种饿汉式，没有直接指定实例，而是在静态代码块中进行赋值。</p>
<h4 id="1-3）懒汉式（线程不安全）">1.3）懒汉式（线程不安全）</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.singleton;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 懒汉式（线程不安全）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton03</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton03</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton03 instance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton03 <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(instance==<span class="literal">null</span>)</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="title class_">Singleton03</span>();</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对比前面的饿汉式，这种方法避免了资源的浪费。用的时候才会判断，没有则会创建。</p>
<p>如此一来，便达到了懒加载的效果。但同时也会带来新的问题，那就是线程不安全。试想一下，如果同时有很多线程获取实例，还没有来得及创建实例，别的线程就又通过了判断，需要创建实例了。</p>
<p>所以在使用这种方式前，只能提前确定当前使用的是否为多线程。</p>
<h4 id="1-4）懒汉式（线程安全，同步方法）">1.4）懒汉式（线程安全，同步方法）</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.singleton;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 懒汉式（线程安全，同步方法）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton04</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton04</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton04 instance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton04 <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(instance==<span class="literal">null</span>)</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="title class_">Singleton04</span>();</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>和上面的懒汉式的区别主要是添加了<code>synchronized</code>，以此来保证线程的安全。</p>
<h4 id="1-5）懒汉式（线程安全，同步代码块）">1.5）懒汉式（线程安全，同步代码块）</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.singleton;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 懒汉式（线程安全，同步代码块）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton05</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton05</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton05 instance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton05 <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span>(Singleton05.class)&#123;</span><br><span class="line">            <span class="keyword">if</span>(instance==<span class="literal">null</span>)</span><br><span class="line">                instance = <span class="keyword">new</span> <span class="title class_">Singleton05</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>和上面的懒汉式对比，仅仅只是将<code>synchronized</code>修饰位置变化一下，对性能的提升不大。</p>
<p>大家都知道，线程安全问题解决，就是需要建立在效率的牺牲上。但无论怎么说，都要比单线程的效率来得高。</p>
<h4 id="1-6）双重检查">1.6）双重检查</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.singleton;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 双重检查</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton06</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton06</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Singleton06 instance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton06 <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(instance==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">synchronized</span>(Singleton06.class)&#123;</span><br><span class="line">                <span class="keyword">if</span>(instance==<span class="literal">null</span>)</span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">Singleton06</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>双重检查，就是对实例判断了两次，并有<code>volatile</code>关键字保证了实例的可见性。相当于对饿汉式（同步代码块）的再度升级版。</p>
<p>这种方式推荐在项目中使用，既有懒加载，线程安全，同时它的效率也相对较高。</p>
<h4 id="1-7）静态内部类">1.7）静态内部类</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.singleton;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 静态内部类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton07</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton07</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span>  <span class="title class_">SingletonInstance</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Singleton07</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton07</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton07 <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonInstance.instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这种方式使用了静态内部类的方法，从而达到懒加载的效果。</p>
<p>怎么会懒加载呢，这里利用了静态内部类的加载特性，当JVM装载<code>Singleton07</code>类时，其内部类并不会进行装载，也就是静态内部类的静态变量还没有初始化。直到<code>getInstance</code>被调用去获取内部类的静态变量时，内部类才进行初始化。</p>
<p>同时，这个静态内部类的装载过程是线程安全的。</p>
<p>这种方式的单例一定得要记住，面试官问你的时候，就可以把面试官往JVM的知识上面引。</p>
<h4 id="1-8）枚举">1.8）枚举</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.singleton;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 枚举</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Singleton08</span> &#123;</span><br><span class="line"></span><br><span class="line">    INSTANCE();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>借助了jdk1.5添加的枚举来实现单例模式，这里只进行编写一个实例，在使用的时候直接取这个实例。这种方式，可以避免线程安全的问题，而且还能防止反序列化时重新创建新对象的问题。</p>
<h3 id="2）工厂模式">2）工厂模式</h3>
<p>当我们想创建一个对象的实例时，我们通常会使用new进行创建，这没什么问题，大多数情况下当然可以这样干。</p>
<p>但如果这个对象的创建比较复杂，需要进行一系列的判断后才知道需要创建哪个对象。一次两次还好，多次创建肯定很烦人，干脆我们把进行创建的那段逻辑代码进行封装，需要获取新的对象时，只需要调用那段封装的代码就可以获取到对象。</p>
<p>所以，工厂模式就来了。它里面封装了一些创建对象的具体细节，外部程序不需要知道，只要自己使用这个工厂类可以获取到自己需要的对象就可以了。</p>
<h4 id="2-1）简单工厂模式">2.1）简单工厂模式</h4>
<p>简单工厂模式，又称为静态工厂模式。其原因是内部的创建是固定的，外部需要什么对象，我生产什么对象。</p>
<p>现有一家面馆，里面售卖牛肉面，鸡蛋面，杂酱面等，那我们将如何使用简单工厂模式获取这些实例呢。</p>
<p>首先我们先写出这三个类，我们用一个抽象类来表示面食，让这三个类去继承它。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.factory.noodle;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 面食抽象类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Noodle</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String area;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Noodle</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.area = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setArea</span><span class="params">(String area)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.area = area;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> area+name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.factory.noodle;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 牛肉面</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeefNoodle</span> <span class="keyword">extends</span> <span class="title class_">Noodle</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BeefNoodle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(<span class="string">&quot;牛肉面&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.factory.noodle;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 鸡蛋面</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EggNoodle</span> <span class="keyword">extends</span> <span class="title class_">Noodle</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">EggNoodle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(<span class="string">&quot;鸡蛋面&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.factory.noodle;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 杂酱面</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MeatSauceNoodle</span> <span class="keyword">extends</span> <span class="title class_">Noodle</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MeatSauceNoodle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(<span class="string">&quot;杂酱面&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>面食的类已经写完，我们接下来编写工厂方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.factory.simple;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 面食工厂</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NoodleFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Noodle <span class="title function_">getNoodle</span><span class="params">(<span class="type">int</span> type)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(type==<span class="number">1001</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BeefNoodle</span>();</span><br><span class="line">        <span class="keyword">if</span>(type==<span class="number">1002</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EggNoodle</span>();</span><br><span class="line">        <span class="keyword">if</span>(type==<span class="number">1003</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MeatSauceNoodle</span>();</span><br><span class="line">        System.out.println(<span class="string">&quot;未知的面食&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>就这就这？对的没错，这段代码就是我们封装进工厂中的繁琐的判断逻辑，通过判断传入的编号，获取面食。</p>
<p>简单写个main方法，进行使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.factory.noodle.Noodle;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.factory.simple.NoodleFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Noodle</span> <span class="variable">noodle1</span> <span class="operator">=</span> NoodleFactory.getNoodle(<span class="number">1001</span>);</span><br><span class="line">        <span class="type">Noodle</span> <span class="variable">noodle2</span> <span class="operator">=</span> NoodleFactory.getNoodle(<span class="number">1002</span>);</span><br><span class="line">        <span class="type">Noodle</span> <span class="variable">noodle3</span> <span class="operator">=</span> NoodleFactory.getNoodle(<span class="number">1003</span>);</span><br><span class="line">        System.out.println(noodle1.getName());</span><br><span class="line">        System.out.println(noodle2.getName());</span><br><span class="line">        System.out.println(noodle3.getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查看执行结果，这里小偷一个懒，获取到的实例需要做判空处理。工厂不可能什么面食都有的，你输入的编号很可能会返回一个<code>null</code>。</p>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220111235735.png" alt="image-20220111235725912" /></p>
<blockquote>
<p>为什么如此简单的判断逻辑，需要进行封装？</p>
<p>因为我这里仅仅只是为了方便举例，在实际的项目中，一个对象的创建远比这要来的复杂。当你只创建一次，那当然按照怎么舒服怎么来。但一旦同样的判断逻辑出现，我建议你封装成工厂进行创建对象。</p>
</blockquote>
<h4 id="2-2）工厂方法模式">2.2）工厂方法模式</h4>
<p>上面介绍了简单工厂模式，这里介绍一下工厂方法模式。</p>
<p>面食的几个类就沿用之前的就好，这里只需要示范下工厂方法模式的写法就好，我们需要一个工厂接口或者工厂抽象类，让其它的子类工厂来实现继承它。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.factory.method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.factory.noodle.Noodle;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象工厂类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractNoodleFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> Noodle <span class="title function_">getNoodle</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.factory.method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.factory.noodle.BeefNoodle;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.factory.noodle.Noodle;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 牛肉面工厂类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeefNoodleFactory</span> <span class="keyword">extends</span> <span class="title class_">AbstractNoodleFactory</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    Noodle <span class="title function_">getNoodle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BeefNoodle</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.factory.method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.factory.noodle.EggNoodle;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.factory.noodle.Noodle;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 鸡蛋面工厂类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EggNoodleFactory</span> <span class="keyword">extends</span> <span class="title class_">AbstractNoodleFactory</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    Noodle <span class="title function_">getNoodle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EggNoodle</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.factory.method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.factory.noodle.MeatSauceNoodle;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.factory.noodle.Noodle;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 杂酱面工厂类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MeatSauceNoodleFactory</span> <span class="keyword">extends</span> <span class="title class_">AbstractNoodleFactory</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    Noodle <span class="title function_">getNoodle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MeatSauceNoodle</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到一个子类工厂只对应生产一种面，在获取面食的时候得到对应的工厂能可以获取到对应的实例了。</p>
<p>好处在于，我们不用去修改原有的代码了。如果又有一种新的炒面，泡面等，只需要再进行添加类即可，对原本的程序代码侵入性几乎为零。</p>
<p>缺点也有，这种方法造成了类爆炸的问题，这也是Java语言被人诟病的原因之一。</p>
<h3 id="3）抽象工厂模式">3）抽象工厂模式</h3>
<p>抽象工厂模式，是上面工厂模式的组合，就是将简单工厂和工厂方法组合弄出了一个更高级的工厂。</p>
<p>这个更高级的工厂就是抽象工厂，它下面有不同的实现工厂，每一个实现工厂都负责生产自己的实例对象。</p>
<p>在这里我们添加一种汤抽象类，并且有两个子类继承于它。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.factory.soup;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 汤抽象类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Soup</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String area;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Soup</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.area = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setArea</span><span class="params">(String area)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.area = area;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> area+name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.factory.soup;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 蛋花汤</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EggDropSoup</span> <span class="keyword">extends</span> <span class="title class_">Soup</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">EggDropSoup</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(<span class="string">&quot;蛋花汤&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.factory.soup;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 鲜鱼汤</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FishSoup</span> <span class="keyword">extends</span> <span class="title class_">Soup</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FishSoup</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(<span class="string">&quot;鲜鱼汤&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>关于汤的类创建完毕，接下来还要创建抽象工厂，这次我们使用接口定义抽象工厂</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.factory.abs;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.factory.noodle.Noodle;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.factory.soup.Soup;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AbstractFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    Noodle <span class="title function_">createNoodle</span><span class="params">(<span class="type">int</span> type)</span>;</span><br><span class="line"></span><br><span class="line">    Soup <span class="title function_">createSoup</span><span class="params">(<span class="type">int</span> type)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以及它的两个子类，具体的工厂</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.factory.abs;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.factory.noodle.BeefNoodle;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.factory.noodle.EggNoodle;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.factory.noodle.MeatSauceNoodle;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.factory.noodle.Noodle;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.factory.soup.EggDropSoup;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.factory.soup.FishSoup;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.factory.soup.Soup;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BJShopFactory</span> <span class="keyword">implements</span> <span class="title class_">AbstractFactory</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Noodle <span class="title function_">createNoodle</span><span class="params">(<span class="type">int</span> type)</span> &#123;</span><br><span class="line">        <span class="type">Noodle</span> <span class="variable">noodle</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(type==<span class="number">1001</span>)</span><br><span class="line">            noodle = <span class="keyword">new</span> <span class="title class_">BeefNoodle</span>();</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(type==<span class="number">1002</span>)</span><br><span class="line">            noodle = <span class="keyword">new</span> <span class="title class_">EggNoodle</span>();</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(type==<span class="number">1003</span>)</span><br><span class="line">            noodle = <span class="keyword">new</span> <span class="title class_">MeatSauceNoodle</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(noodle==<span class="literal">null</span>)</span><br><span class="line">            System.out.println(<span class="string">&quot;未知的面食&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            noodle.setArea(<span class="string">&quot;北京&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> noodle;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Soup <span class="title function_">createSoup</span><span class="params">(<span class="type">int</span> type)</span> &#123;</span><br><span class="line">        <span class="type">Soup</span> <span class="variable">soup</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(type==<span class="number">2001</span>)</span><br><span class="line">            soup = <span class="keyword">new</span> <span class="title class_">EggDropSoup</span>();</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(type==<span class="number">2002</span>)</span><br><span class="line">            soup = <span class="keyword">new</span> <span class="title class_">FishSoup</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(soup==<span class="literal">null</span>)</span><br><span class="line">            System.out.println(<span class="string">&quot;未知的汤&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            soup.setArea(<span class="string">&quot;北京&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> soup;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.factory.abs;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.factory.noodle.BeefNoodle;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.factory.noodle.EggNoodle;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.factory.noodle.MeatSauceNoodle;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.factory.noodle.Noodle;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.factory.soup.EggDropSoup;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.factory.soup.FishSoup;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.factory.soup.Soup;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GZShopFactory</span> <span class="keyword">implements</span> <span class="title class_">AbstractFactory</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Noodle <span class="title function_">createNoodle</span><span class="params">(<span class="type">int</span> type)</span> &#123;</span><br><span class="line">        <span class="type">Noodle</span> <span class="variable">noodle</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(type==<span class="number">1001</span>)</span><br><span class="line">            noodle = <span class="keyword">new</span> <span class="title class_">BeefNoodle</span>();</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(type==<span class="number">1002</span>)</span><br><span class="line">            noodle = <span class="keyword">new</span> <span class="title class_">EggNoodle</span>();</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(type==<span class="number">1003</span>)</span><br><span class="line">            noodle = <span class="keyword">new</span> <span class="title class_">MeatSauceNoodle</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(noodle==<span class="literal">null</span>)</span><br><span class="line">            System.out.println(<span class="string">&quot;未知的面食&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            noodle.setArea(<span class="string">&quot;广州&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> noodle;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Soup <span class="title function_">createSoup</span><span class="params">(<span class="type">int</span> type)</span> &#123;</span><br><span class="line">        <span class="type">Soup</span> <span class="variable">soup</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(type==<span class="number">2001</span>)</span><br><span class="line">            soup = <span class="keyword">new</span> <span class="title class_">EggDropSoup</span>();</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(type==<span class="number">2002</span>)</span><br><span class="line">            soup = <span class="keyword">new</span> <span class="title class_">FishSoup</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(soup==<span class="literal">null</span>)</span><br><span class="line">            System.out.println(<span class="string">&quot;未知的汤&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            soup.setArea(<span class="string">&quot;广州&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> soup;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>简单获取一种工厂，并得到它生产的实例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.factory.abs.AbstractFactory;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.factory.abs.GZShopFactory;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.factory.noodle.Noodle;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.factory.soup.Soup;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">AbstractFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GZShopFactory</span>();</span><br><span class="line">        <span class="type">Noodle</span> <span class="variable">noodle</span> <span class="operator">=</span> factory.createNoodle(<span class="number">1001</span>);</span><br><span class="line">        <span class="type">Soup</span> <span class="variable">soup</span> <span class="operator">=</span> factory.createSoup(<span class="number">2001</span>);</span><br><span class="line">        System.out.println(noodle.getName());</span><br><span class="line">        System.out.println(soup.getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220113223126.png" alt="image-20220113223051902" /></p>
<blockquote>
<p>工厂模式并不算复杂，难的是如何结合业务，造出一个高度复用的轮子。</p>
<p>大家都可以去看看优秀的工厂案例，分析一下他们使用的是哪种工厂模式。</p>
<p><code>LoggerFactory</code>，<code>BeanFactory</code>，<code>java.util.Calendar#createCalendar</code></p>
</blockquote>
<h3 id="4）原型模式">4）原型模式</h3>
<p>知道克隆羊多莉吗，这是从两只羊的细胞克隆出来的羊，通过现代工程创造出来的绵羊，也是世界之初第一个成功克隆的哺乳动物。</p>
<p>那么在程序的世界里，对象的克隆就显得十分重要了。简单看下面这个类，目前我有一个实例，如何快速的克隆这个对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.prototype;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Sheep</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.prototype.Sheep;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Sheep</span> <span class="variable">sheep</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Sheep</span>(<span class="string">&quot;多莉&quot;</span>, <span class="number">6</span>, <span class="string">&quot;白色&quot;</span>);</span><br><span class="line">        System.out.println(sheep);</span><br><span class="line">        System.out.println(<span class="string">&quot;=========== 分割线 ===========&quot;</span>);</span><br><span class="line">        <span class="comment">// 克隆</span></span><br><span class="line">        <span class="type">Sheep</span> <span class="variable">sheep1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Sheep</span>(sheep.getName(), sheep.getAge(), sheep.getColor());</span><br><span class="line">        <span class="type">Sheep</span> <span class="variable">sheep2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Sheep</span>(sheep.getName(), sheep.getAge(), sheep.getColor());</span><br><span class="line">        <span class="type">Sheep</span> <span class="variable">sheep3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Sheep</span>(sheep.getName(), sheep.getAge(), sheep.getColor());</span><br><span class="line">        <span class="type">Sheep</span> <span class="variable">sheep4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Sheep</span>(sheep.getName(), sheep.getAge(), sheep.getColor());</span><br><span class="line">        System.out.println(sheep1);</span><br><span class="line">        System.out.println(sheep2);</span><br><span class="line">        System.out.println(sheep3);</span><br><span class="line">        System.out.println(sheep4);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查看结果，属性完全一致，克隆成功<br />
<img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220114213841.png" alt="image-20220114213840052" /></p>
<p>但这样是有问题的，万一这羊突然增加了一个属性，我们每一个克隆的代码就都要进行修改，这明显违背的开闭原则。</p>
<h4 id="4-1）浅拷贝">4.1）浅拷贝</h4>
<p>我们可以这样改进，修改羊实现<code>Cloneable</code>，调用<code>clone</code>方法即可，这是java为我们准备好的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.prototype;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Sheep</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.clone();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.prototype;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Sheep</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.clone();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果，这样就可以达到克隆的效果了</p>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220114215102.png" alt="image-20220114215100480" /></p>
<p>那么，我们在添加一个新的类，对这个农场主进行克隆会怎么样</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.prototype;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Estanciero</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Sheep&gt; sheepList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.clone();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.prototype;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.collection.CollUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PrototypeMain</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="type">Sheep</span> <span class="variable">sheep</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Sheep</span>(<span class="string">&quot;多莉&quot;</span>, <span class="number">6</span>, <span class="string">&quot;白色&quot;</span>);</span><br><span class="line">        <span class="type">Estanciero</span> <span class="variable">estanciero</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Estanciero</span>(<span class="string">&quot;农场主A&quot;</span>, CollUtil.newArrayList(sheep));</span><br><span class="line">        System.out.println(estanciero);</span><br><span class="line">        System.out.println(<span class="string">&quot;=========== 分割线 ===========&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Estanciero</span> <span class="variable">estanciero1</span> <span class="operator">=</span> (Estanciero) estanciero.clone();</span><br><span class="line">        System.out.println(estanciero1);</span><br><span class="line">        System.out.println(StrUtil.format(<span class="string">&quot;农场主是否一致：&#123;&#125;，羊是否一致：&#123;&#125;&quot;</span>,</span><br><span class="line">                estanciero==estanciero1, estanciero.getSheepList()==estanciero1.getSheepList()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果，发现了克隆出来的农场主是新的实例，但它的引用对象还是指向了原来的空间，这就是浅拷贝。</p>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220114223201.png" alt="image-20220114223159562" /></p>
<h4 id="4-2）套娃型深拷贝">4.2）套娃型深拷贝</h4>
<p>套娃型深拷贝？为什么这么叫呢，这种方法就是将重写clone方法，自己加上引用对象的克隆。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.prototype;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Estanciero</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Sheep&gt; sheepList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="type">Estanciero</span> <span class="variable">estanciero</span> <span class="operator">=</span> (Estanciero) <span class="built_in">super</span>.clone();</span><br><span class="line">        <span class="keyword">if</span>(estanciero.getSheepList()!=<span class="literal">null</span>)&#123;</span><br><span class="line">            ArrayList&lt;Sheep&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            estanciero.getSheepList().forEach(sheep -&gt; list.add(sheep));</span><br><span class="line">            estanciero.setSheepList(list);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> estanciero;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重新执行测试结果，你也可以将list里面的羊拿出来做对比，克隆出来的引用都是新的对象。</p>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220115181357.png" alt="image-20220115181356315" /></p>
<h4 id="4-3）序列化深拷贝">4.3）序列化深拷贝</h4>
<p>上面套娃型深拷贝有个弊端，即类中所有引用的对象都要像浅拷贝那样，实现<code>Cloneable</code>接口。如果引用的对象还有引用，那么恭喜你，你要套娃去写<code>Cloneable</code> 了。</p>
<p>这上面的就是它的弊端，所以序列化深拷贝来了。</p>
<p>我们将<code>Estanciero</code>和<code>Sheep</code>类实现<code>Serializable</code>序列化接口，再写一个序列化反序列化克隆的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.prototype;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.io.IoUtil;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Estanciero</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span>, Serializable &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Sheep&gt; sheepList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="type">Estanciero</span> <span class="variable">estanciero</span> <span class="operator">=</span> (Estanciero) <span class="built_in">super</span>.clone();</span><br><span class="line">        <span class="keyword">if</span>(estanciero.getSheepList()!=<span class="literal">null</span>)&#123;</span><br><span class="line">            ArrayList&lt;Sheep&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            estanciero.getSheepList().forEach(sheep -&gt; list.add(sheep));</span><br><span class="line">            estanciero.setSheepList(list);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> estanciero;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Estanciero <span class="title function_">cloneBySerializable</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// 创建输出流</span></span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">bos</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">// 创建输入流</span></span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">bis</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 序列化当前对象</span></span><br><span class="line">            bos = <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">            oos = <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(bos);</span><br><span class="line">            oos.writeObject(<span class="built_in">this</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 反序列化</span></span><br><span class="line">            bis = <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(bos.toByteArray());</span><br><span class="line">            ois = <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(bis);</span><br><span class="line">            <span class="type">Estanciero</span> <span class="variable">copyEstanciero</span> <span class="operator">=</span> (Estanciero) ois.readObject();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> copyEstanciero;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 关闭流</span></span><br><span class="line">            IoUtil.close(bos);</span><br><span class="line">            IoUtil.close(oos);</span><br><span class="line">            IoUtil.close(bis);</span><br><span class="line">            IoUtil.close(ois);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.prototype;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.collection.CollUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PrototypeMain</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="type">Sheep</span> <span class="variable">sheep</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Sheep</span>(<span class="string">&quot;多莉&quot;</span>, <span class="number">6</span>, <span class="string">&quot;白色&quot;</span>);</span><br><span class="line">        <span class="type">Estanciero</span> <span class="variable">estanciero</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Estanciero</span>(<span class="string">&quot;农场主A&quot;</span>, CollUtil.newArrayList(sheep));</span><br><span class="line">        System.out.println(estanciero);</span><br><span class="line">        System.out.println(<span class="string">&quot;=========== 分割线 ===========&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        Estanciero estanciero1 = (Estanciero) estanciero.clone();</span></span><br><span class="line">        <span class="type">Estanciero</span> <span class="variable">estanciero1</span> <span class="operator">=</span> estanciero.cloneBySerializable();</span><br><span class="line">        System.out.println(estanciero1);</span><br><span class="line">        System.out.println(StrUtil.format(<span class="string">&quot;农场主是否一致：&#123;&#125;，羊是否一致：&#123;&#125;&quot;</span>,</span><br><span class="line">                estanciero==estanciero1, estanciero.getSheepList()==estanciero1.getSheepList()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果，这种方法也可以实现深拷贝，也是比较推荐的方法</p>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220115191956.png" alt="image-20220115191954678" /></p>
<h4 id="4-4）使用第三方工具包">4.4）使用第三方工具包</h4>
<p>上面的原型只做了解，讲真我不喜欢用，不是因为有工具类，单纯觉得上面的方法难用（不难用的话，对应的工具包都出不来）。</p>
<p>使用apache的BeanUtils，实现克隆</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.prototype;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.collection.CollUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.beanutils.BeanUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CopyUtilMain</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InvocationTargetException, IllegalAccessException, InstantiationException, NoSuchMethodException &#123;</span><br><span class="line">        <span class="type">Sheep</span> <span class="variable">sheep</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Sheep</span>(<span class="string">&quot;多莉&quot;</span>, <span class="number">6</span>, <span class="string">&quot;白色&quot;</span>);</span><br><span class="line">        <span class="type">Estanciero</span> <span class="variable">estanciero</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Estanciero</span>(<span class="string">&quot;农场主A&quot;</span>, CollUtil.newArrayList(sheep));</span><br><span class="line">        System.out.println(estanciero);</span><br><span class="line"></span><br><span class="line">        System.out.println(System.lineSeparator() + <span class="string">&quot;=========== 分割线 Apache ===========&quot;</span>);</span><br><span class="line">        <span class="type">Estanciero</span> <span class="variable">estanciero1</span> <span class="operator">=</span> (Estanciero) BeanUtils.cloneBean(estanciero);</span><br><span class="line">        System.out.println(estanciero1);</span><br><span class="line">        System.out.println(StrUtil.format(<span class="string">&quot;农场主是否一致：&#123;&#125;，羊是否一致：&#123;&#125;&quot;</span>,</span><br><span class="line">                estanciero==estanciero1, estanciero.getSheepList()==estanciero1.getSheepList()));</span><br><span class="line"></span><br><span class="line">        System.out.println(System.lineSeparator() + <span class="string">&quot;=========== 分割线 Spring ===========&quot;</span>);</span><br><span class="line">        <span class="type">Estanciero</span> <span class="variable">estanciero2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Estanciero</span>();</span><br><span class="line">        org.springframework.beans.BeanUtils.copyProperties(estanciero, estanciero2);</span><br><span class="line">        System.out.println(estanciero2);</span><br><span class="line">        System.out.println(StrUtil.format(<span class="string">&quot;农场主是否一致：&#123;&#125;，羊是否一致：&#123;&#125;&quot;</span>,</span><br><span class="line">                estanciero==estanciero2, estanciero.getSheepList()==estanciero2.getSheepList()));</span><br><span class="line"></span><br><span class="line">        System.out.println(System.lineSeparator() + <span class="string">&quot;=========== 分割线 fastjson序列化 ===========&quot;</span>);</span><br><span class="line">        <span class="type">Estanciero</span> <span class="variable">estanciero3</span> <span class="operator">=</span> JSON.parseObject(JSON.toJSONString(estanciero), Estanciero.class);</span><br><span class="line">        System.out.println(estanciero3);</span><br><span class="line">        System.out.println(StrUtil.format(<span class="string">&quot;农场主是否一致：&#123;&#125;，羊是否一致：&#123;&#125;&quot;</span>,</span><br><span class="line">                estanciero==estanciero3, estanciero.getSheepList()==estanciero3.getSheepList()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果，注意看它们的克隆是浅拷贝还是深拷贝</p>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220115201511.png" alt="image-20220115201510378" /></p>
<h3 id="5）建造者模式">5）建造者模式</h3>
<p>建造者模式，就是将一个对象组装出来，通过这个对象内的成员属性，一步一步的将这个类实例化。还有不一样的构建顺序，可能导致最终构造出来的实例也是不同的</p>
<h4 id="5-1）示例">5.1）示例</h4>
<p>比如说，房子的创建步骤可以简单分为打地基、砌墙、封顶。但不同的房子，他们每一个步骤都不是一样的。想想看，普通房子和高楼大厦使用的是一样吗。</p>
<p>所以我们就先创建一个抽象类，将打地基、砌墙、封顶作为抽象方法，让具体的类去实现。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.builder.house;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">House</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String subgrade;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String wall;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String roof;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> StrUtil.format(<span class="string">&quot;地基：&#123;&#125;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;砌墙：&#123;&#125;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;封顶：&#123;&#125;&quot;</span>, subgrade, wall, roof);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>两个具体的实现类，高楼房类和公共平房类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.builder.house;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HighHouse</span> <span class="keyword">extends</span> <span class="title class_">House</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.builder.house;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonHouse</span> <span class="keyword">extends</span> <span class="title class_">House</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>两个房子弄好了后，我们需要建造者。同样对应上面的房子，一个抽象，两个实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.builder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.builder.house.House;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">HouseBuilder</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> House house;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HouseBuilder</span><span class="params">(House house)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.house = house;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> HouseBuilder <span class="title function_">buildSubgrade</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> HouseBuilder <span class="title function_">buildWall</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> HouseBuilder <span class="title function_">buildRoof</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> House <span class="title function_">build</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> house;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.builder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.builder.house.HighHouse;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.builder.house.House;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HighHouseBuilder</span> <span class="keyword">extends</span> <span class="title class_">HouseBuilder</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HighHouseBuilder</span><span class="params">(House house)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(<span class="keyword">new</span> <span class="title class_">HighHouse</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> HouseBuilder <span class="title function_">buildSubgrade</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.house.setSubgrade(<span class="string">&quot;打10米深的地基&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> HouseBuilder <span class="title function_">buildWall</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.house.setWall(<span class="string">&quot;打20厘米宽的墙&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> HouseBuilder <span class="title function_">buildRoof</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.house.setRoof(<span class="string">&quot;盖钢化玻璃封顶&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.builder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.builder.house.CommonHouse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonHouseBuilder</span> <span class="keyword">extends</span> <span class="title class_">HouseBuilder</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CommonHouseBuilder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(<span class="keyword">new</span> <span class="title class_">CommonHouse</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> HouseBuilder <span class="title function_">buildSubgrade</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.house.setSubgrade(<span class="string">&quot;打2米深的地基&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> HouseBuilder <span class="title function_">buildWall</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.house.setWall(<span class="string">&quot;打10厘米宽的墙&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> HouseBuilder <span class="title function_">buildRoof</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.house.setRoof(<span class="string">&quot;盖瓦片封顶&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时，还需要一个指挥者，与建造者进行组合。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.builder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.builder.house.House;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Director</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> HouseBuilder builder;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Director</span><span class="params">(HouseBuilder builder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.builder = builder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> House <span class="title function_">construct</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> builder.buildSubgrade()</span><br><span class="line">                .buildWall()</span><br><span class="line">                .buildRoof()</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样，就准备完了，如何使用呢</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.builder.CommonHouseBuilder;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.builder.Director;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.builder.house.House;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">House</span> <span class="variable">house</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Director</span>(<span class="keyword">new</span> <span class="title class_">CommonHouseBuilder</span>()).construct();</span><br><span class="line">        System.out.println(house.toString());</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;=========== 分割线 ===========&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">House</span> <span class="variable">house1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Director</span>(<span class="keyword">new</span> <span class="title class_">CommonHouseBuilder</span>()).construct();</span><br><span class="line">        System.out.println(house1.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查看结果</p>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220117223904.png" alt="image-20220117223903059" /></p>
<p>由于它们之间的关系比较复杂，所以画了一个UML类图加深理解</p>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220117231034.png" alt="image-20220117231031962" /></p>
<h4 id="5-2）简化与问题">5.2）简化与问题</h4>
<p>在上述的示例中，我们能感觉到十分的繁琐。在实际开发中，我们可以进行一些简化</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>如果只有一个具体对象，那么我们也就不需要抽象建造者了，只需要一个具体建造者</p>
</li>
<li class="lvl-2">
<p>如果创建的对象对建造顺序不重要，那么我们可以取消掉指挥者</p>
</li>
</ul>
<p>由于建造者的书写十分繁琐，所以Lombok推出了简化，使用注解<code>@Builder</code>，示例如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.builder.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Builder;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserInfo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String nickname;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用示例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.builder.demo.UserInfo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UserInfo</span> <span class="variable">userInfo</span> <span class="operator">=</span> UserInfo.builder()</span><br><span class="line">                .username(<span class="string">&quot;banmoon&quot;</span>)</span><br><span class="line">                .password(<span class="string">&quot;2022&quot;</span>)</span><br><span class="line">                .nickname(<span class="string">&quot;半月无霜&quot;</span>)</span><br><span class="line">                .address(<span class="string">&quot;广州&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">        System.out.println(userInfo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>建造模式与工厂模式的区别</p>
<p>我相信这是很多人比较困扰的，实际上这很好理解。</p>
<ul class="lvl-1">
<li class="lvl-2">
<p>工厂模式不关心内部的构造，只需要准备好参数，让工厂直接返回实例即可。</p>
</li>
<li class="lvl-2">
<p>造者不同，它的每一步外部都是知道的，更关心创建内部的细节。</p>
</li>
<li class="lvl-2">
<p>建造者模式更加注重方法的调用顺序，可以灵活调用，而工厂模式不关心内部参数的调用顺序</p>
</li>
</ul>
</blockquote>
<blockquote>
<p>在什么场景下使用建造模式</p>
<ul class="lvl-1">
<li class="lvl-2">相同的方法，不同的执行顺序，产生不同的结果。</li>
<li class="lvl-2">多个部件或零件，都可以装配到一个对象中，但是产生的结果又不相同。</li>
<li class="lvl-2">产品类非常复杂，或者产品类中不同的调用顺序产生不同的作用。</li>
<li class="lvl-2">初始化一个对象特别复杂，参数多，而且很多参数都具有默认值。</li>
</ul>
</blockquote>
<h2 id="四、结构型设计模式">四、结构型设计模式</h2>
<h3 id="6）适配器模式">6）适配器模式</h3>
<p>在生活中，我们常常会遇到充电口不匹配的情况，出去旅游的小伙伴感触会深点，国外的插座和我们的不是一个型号，这样的话，我们只需要一个中间层充当适配器的角色，所以适配器模式它来了。</p>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220119203228.png" alt="image-20220119203226491" /></p>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220119203344.png" alt="image-20220119203343191" /></p>
<p>简单了解以前这三点命名概念</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>source：源，被适配的对象，对应的就是上图描述的插座</p>
</li>
<li class="lvl-2">
<p>adapter：适配器，对应的就是充电转接器</p>
</li>
<li class="lvl-2">
<p>target：目标，对应的就是充电器</p>
</li>
</ul>
<p>适配器模式可以分为<b>类适配器模式</b>、<b>对象适配器模式</b>、<b>接口适配器模式</b>。</p>
<h4 id="6-1）类适配器模式">6.1）类适配器模式</h4>
<p>我们来对电压进行讲解，平常的家庭用电都是220V，经过充电头的转换，将220V的电压转为5V，这样的低电压手机才能使用。</p>
<p>先写一个输出220V电压的类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.adapter.classmode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Electricity220V</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">voltage</span> <span class="operator">=</span> <span class="number">220</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">output</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(StrUtil.format(<span class="string">&quot;输出电压：&#123;&#125;V&quot;</span>, voltage));</span><br><span class="line">        <span class="keyword">return</span> voltage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这时我们需要一个充电器，这个充电器就是一个适配器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.adapter.classmode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ElectricityAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">transform</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.adapter.classmode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Electricity220VTo5VAdapter</span> <span class="keyword">extends</span> <span class="title class_">Electricity220V</span> <span class="keyword">implements</span> <span class="title class_">ElectricityAdapter</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">transform</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">voltage</span> <span class="operator">=</span> <span class="built_in">super</span>.output();</span><br><span class="line">        <span class="type">int</span> <span class="variable">newVoltage</span> <span class="operator">=</span> voltage - <span class="number">215</span>;</span><br><span class="line">        System.out.println(StrUtil.format(<span class="string">&quot;成功：已将&#123;&#125;V转化为&#123;&#125;V&quot;</span>, voltage, newVoltage));</span><br><span class="line">        System.out.println(StrUtil.format(<span class="string">&quot;输出电压：&#123;&#125;V&quot;</span>, newVoltage));</span><br><span class="line">        <span class="keyword">return</span> newVoltage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再来一个手机，里面给一个充电的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.adapter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Phone</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recharge</span><span class="params">(<span class="type">int</span> voltage)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(voltage==<span class="number">5</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;手机正在充电中&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;电压不匹配，手机要爆了&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们进行测试，在使用适配器后，电压会降低为5V给手机供电</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.adapter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.adapter.classmode.Electricity220VTo5VAdapter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Phone</span> <span class="variable">phone</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Phone</span>();</span><br><span class="line">        phone.recharge(<span class="keyword">new</span> <span class="title class_">Electricity220VTo5VAdapter</span>().transform());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果</p>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220119211143.png" alt="image-20220119211141703" /></p>
<p>类适配器的特点，由于是继承源对象，所以造成了一定的耦合。</p>
<p>而且，如果适配器没有重写源对象的方法，那就意味着适配器上就可以获得源对象的方法和属性。</p>
<p>所以这点原因，此适配器不推荐使用</p>
<h4 id="6-2）对象适配器模式">6.2）对象适配器模式</h4>
<p>在里氏替换原则中，能不用继承就不用继承，改用组合，聚合的方法来代替继承。</p>
<p>这点很好理解，在外部将返回的电压转换就可以了。</p>
<p>220V电压，没什么问题，也不做改动</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.adapter.objmode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Electricity220V</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">voltage</span> <span class="operator">=</span> <span class="number">220</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">output</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(StrUtil.format(<span class="string">&quot;输出电压：&#123;&#125;V&quot;</span>, voltage));</span><br><span class="line">        <span class="keyword">return</span> voltage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>适配器接口，不做改变</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.adapter.objmode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ElectricityAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">transform</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>适配器类将不再继承220V电压，改用组合的形式。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.adapter.objmode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Electricity220VTo5VAdapter</span> <span class="keyword">implements</span> <span class="title class_">ElectricityAdapter</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Electricity220V electricity220V;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Electricity220VTo5VAdapter</span><span class="params">(Electricity220V electricity220V)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.electricity220V = electricity220V;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">transform</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">voltage</span> <span class="operator">=</span> electricity220V.output();</span><br><span class="line">        <span class="type">int</span> <span class="variable">newVoltage</span> <span class="operator">=</span> voltage - <span class="number">215</span>;</span><br><span class="line">        System.out.println(StrUtil.format(<span class="string">&quot;成功：已将&#123;&#125;V转化为&#123;&#125;V&quot;</span>, voltage, newVoltage));</span><br><span class="line">        System.out.println(StrUtil.format(<span class="string">&quot;输出电压：&#123;&#125;V&quot;</span>, newVoltage));</span><br><span class="line">        <span class="keyword">return</span> newVoltage;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们再进行一个测试使用，在使用适配器时，需要传入一个220V的实例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.adapter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.adapter.objmode.Electricity220V;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.adapter.objmode.Electricity220VTo5VAdapter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Phone</span> <span class="variable">phone</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Phone</span>();</span><br><span class="line">        <span class="type">Electricity220VTo5VAdapter</span> <span class="variable">adapter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Electricity220VTo5VAdapter</span>(<span class="keyword">new</span> <span class="title class_">Electricity220V</span>());</span><br><span class="line">        phone.recharge(adapter.transform());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220119213223.png" alt="image-20220119213218720" /></p>
<h4 id="6-3）接口适配器模式">6.3）接口适配器模式</h4>
<p>当一个接口有四个方法，而这四个方法都需要实现，这是正常的实现类，没什么问题。</p>
<p>但问题是，如果一个类就不想实现其中的两个方法，只需要实现两个就够了，那该怎么办。</p>
<p>这时，我想到了偶像练习生。一般来说，他们都会唱、跳、Rap、篮球。但总有几个练习生拉跨怎么办。接口适配器可以解决这个问题。</p>
<p>接口适配器，又叫默认（缺省）适配器。先将使用一个抽象类来实现这个接口，里面写上默认的方法。由于是抽象类，它又不能直接实例化，抽象类也需要被继承才能实例化。而此时，就可以想实现哪个方法，就实现哪个方法了。</p>
<p>我们就举偶像练习生这个例子，我们先写一个接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.adapter.interfacemode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ITrainee</span> &#123;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">getName</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    String[] chang();</span><br><span class="line"></span><br><span class="line">    String[] tiao();</span><br><span class="line"></span><br><span class="line">    String[] rap();</span><br><span class="line"></span><br><span class="line">    String[] lanqiu();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接着我们需要一个中间层的适配器，里面默认他什么都不会，但这只是一个抽象的练习生</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.adapter.interfacemode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbsTrainee</span> <span class="keyword">implements</span> <span class="title class_">ITrainee</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AbsTrainee</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] chang() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] tiao() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] rap() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] lanqiu() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们来一个真正的练习生类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.adapter.interfacemode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CXK</span> <span class="keyword">extends</span> <span class="title class_">AbsTrainee</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CXK</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] chang() &#123;</span><br><span class="line">        String[] chang = &#123;<span class="string">&quot;鸡你太美&quot;</span>, <span class="string">&quot;鸡你太美鬼畜版&quot;</span>&#125;;</span><br><span class="line">        <span class="keyword">return</span> chang;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] tiao() &#123;</span><br><span class="line">        String[] tiao = &#123;<span class="string">&quot;与篮球的独舞&quot;</span>&#125;;</span><br><span class="line">        <span class="keyword">return</span> tiao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] lanqiu() &#123;</span><br><span class="line">        String[] lanqiu = &#123;<span class="string">&quot;美国校队担当&quot;</span>&#125;;</span><br><span class="line">        <span class="keyword">return</span> lanqiu;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再来一个舞台吧，用来展示练习生的才艺的舞台</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.adapter.interfacemode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.ArrayUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Stage</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">(ITrainee iTrainee)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> iTrainee.getName();</span><br><span class="line">        String[] chang = iTrainee.chang();</span><br><span class="line">        System.out.println(StrUtil.format(<span class="string">&quot;&#123;&#125;开始唱歌：&#123;&#125;&quot;</span>, name,</span><br><span class="line">                ArrayUtil.isEmpty(chang)? <span class="string">&quot;他怎么什么都不会&quot;</span>: chang));</span><br><span class="line">        String[] tiao = iTrainee.tiao();</span><br><span class="line">        System.out.println(StrUtil.format(<span class="string">&quot;&#123;&#125;开始跳舞：&#123;&#125;&quot;</span>, name,</span><br><span class="line">                ArrayUtil.isEmpty(tiao)? <span class="string">&quot;他怎么什么都不会&quot;</span>: tiao));</span><br><span class="line">        String[] rap = iTrainee.rap();</span><br><span class="line">        System.out.println(StrUtil.format(<span class="string">&quot;&#123;&#125;开始rap：&#123;&#125;&quot;</span>, name,</span><br><span class="line">                ArrayUtil.isEmpty(rap)? <span class="string">&quot;他怎么什么都不会&quot;</span>: rap));</span><br><span class="line">        String[] lanqiu = iTrainee.lanqiu();</span><br><span class="line">        System.out.println(StrUtil.format(<span class="string">&quot;&#123;&#125;开始打篮球：&#123;&#125;&quot;</span>, name,</span><br><span class="line">                ArrayUtil.isEmpty(lanqiu)? <span class="string">&quot;他怎么什么都不会&quot;</span>: lanqiu));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>准备就绪，我们来进行测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.adapter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.adapter.interfacemode.AbsTrainee;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.adapter.interfacemode.CXK;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.adapter.interfacemode.Stage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Stage</span> <span class="variable">stage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Stage</span>();</span><br><span class="line">        stage.show(<span class="keyword">new</span> <span class="title class_">CXK</span>(<span class="string">&quot;KUN&quot;</span>));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;================== 分隔符 ==================&quot;</span>);</span><br><span class="line"></span><br><span class="line">        stage.show(<span class="keyword">new</span> <span class="title class_">AbsTrainee</span>(<span class="string">&quot;初音&quot;</span>) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> String[] chang() &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;甩葱歌&quot;</span>&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果，除了CXK这个类外，还有另外一个匿名内部类，她的甩葱歌是真的洗脑</p>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220119221754.png" alt="image-20220119221753343" /></p>
<h3 id="7）桥接模式">7）桥接模式</h3>
<p>在现实生活中，手机有着不同的品牌，型号。如果用Java来将他们作为类，你该怎么搞。</p>
<p>可以使用继承，顶上一个父类<code>Phone</code>，它的子类就会出现小米牌手机<code>MiPhone</code>、华为手机<code>HuaweiPhone</code>等等。乍一看没什么问题，也可以使，但是要是加上型号呢？那就会出现下图的结果</p>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220123115444.png" alt="image-20220123115442713" /></p>
<p>这种问题被称为类爆炸问题，当然你也可以将品牌和型号作为手机的一个属性，这样来区分他们的不同品牌型号的手机。然而桥接模式就是这样思考的。</p>
<p>桥接模式，将上述类型拆成两部分。比如说上面的手机，一部分为抽象类手机，另一部分则拆为品牌接口。抽象类手机则有这样的一个品牌属性，这样抽象类手机的子类就能明确知道是什么品牌型号的手机了。</p>
<p>这一层被称为实现层。先写出一个品牌接口，以及它的两个实现类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.birdge.brand;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 品牌接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Brand</span> &#123;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">getBrandName</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.birdge.brand;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Huawei</span> <span class="keyword">implements</span> <span class="title class_">Brand</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getBrandName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;华为&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.birdge.brand;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Mi</span> <span class="keyword">implements</span> <span class="title class_">Brand</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getBrandName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;小米&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这一层叫做抽象层，会将上面实现层的类作为属性使用。写一个抽象类，再写它的两个子类，分别为<mark>折叠屏手机</mark>和<mark>全面屏手机</mark>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.birdge.phone;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.birdge.brand.Brand;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Phone</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Brand brand;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Phone</span><span class="params">(Brand brand)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.brand = brand;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title function_">getPhoneName</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.birdge.phone;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.birdge.brand.Brand;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FullScreenPhone</span> <span class="keyword">extends</span> <span class="title class_">Phone</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FullScreenPhone</span><span class="params">(Brand brand)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(brand);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPhoneName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;全面屏&quot;</span> + brand.getBrandName() + <span class="string">&quot;手机&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.birdge.phone;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.birdge.brand.Brand;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FoldablePhone</span> <span class="keyword">extends</span> <span class="title class_">Phone</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FoldablePhone</span><span class="params">(Brand brand)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(brand);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPhoneName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;折叠屏&quot;</span> + brand.getBrandName() + <span class="string">&quot;手机&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面两层都已经写完，我们再来进行测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.birdge;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.birdge.brand.Huawei;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.birdge.brand.Mi;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.birdge.phone.FoldablePhone;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.birdge.phone.FullScreenPhone;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BirdgeMain</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">FullScreenPhone</span> <span class="variable">phone</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FullScreenPhone</span>(<span class="keyword">new</span> <span class="title class_">Mi</span>());</span><br><span class="line">        <span class="type">String</span> <span class="variable">phoneName</span> <span class="operator">=</span> phone.getPhoneName();</span><br><span class="line">        System.out.println(phoneName);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;============= 分割线 =============&quot;</span>);</span><br><span class="line">        <span class="type">FoldablePhone</span> <span class="variable">phone1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FoldablePhone</span>(<span class="keyword">new</span> <span class="title class_">Huawei</span>());</span><br><span class="line">        <span class="type">String</span> <span class="variable">phoneName1</span> <span class="operator">=</span> phone1.getPhoneName();</span><br><span class="line">        System.out.println(phoneName1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果</p>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220123145015.png" alt="image-20220123145011769" /></p>
<blockquote>
<p>以上面手机举例，它有两层维度。一个是品牌，一个是型号。</p>
<p>桥接模式，只是将一个维度作为了抽象层，另一个维度作为实现层，通过组合的方式进行关联。上面举例将品牌作为了抽象层，将型号作为了实现层，这个我觉得反过来定义也没有什么问题。不过具体设计时，还是要根据实际业务出发，达到一个容易理解的设计。</p>
<p>若以后还有什么新的品牌，只需要再进行实现品牌接口即可，对原本的代码没有侵害。</p>
<p>如果需要新增维度，那么只需要将其再作为实现层，通过组合的方式进行关联即可。</p>
</blockquote>
<h3 id="8）装饰模式">8）装饰模式</h3>
<p>我们来简单实现下这个功能，点杯咖啡，咖啡种类挺多，有美式咖啡，有浓缩咖啡等。这还不够，额外还可以添加方糖，牛奶或者巧克力。</p>
<p>上述添加选择完后，就是我们想要的，问如何设计上述场景的结构。</p>
<h4 id="8-1）我的设计">8.1）我的设计</h4>
<p>额，在我没有学习装饰模式前，我会这样设计。</p>
<p>既然方糖，牛奶，巧克力都是添加至到咖啡内的，我就将咖啡弄成一个抽象类，抽象类中有三个属性，分别是方糖，牛奶和巧克力。不同的咖啡种类继承这个咖啡抽象类。在使用时，根据自己的情况先点咖啡，再选择自己的方糖等调料。</p>
<p>我用代码简单来演示一下，先写出方糖、牛奶、巧克力三个类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.decorator.myimpl.dosing;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Sugar</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Float</span> <span class="variable">price</span> <span class="operator">=</span> <span class="number">2F</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;方糖&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.decorator.myimpl.dosing;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Milk</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Float</span> <span class="variable">price</span> <span class="operator">=</span> <span class="number">3F</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;牛奶&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.decorator.myimpl.dosing;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Chocolate</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Float</span> <span class="variable">price</span> <span class="operator">=</span> <span class="number">4F</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;巧克力&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再来个咖啡的抽象类，里面定义上述几个类的属性，自身的价格，两个抽象的方法交由子类去重写。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.decorator.myimpl.coffee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.decorator.myimpl.dosing.Chocolate;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.decorator.myimpl.dosing.Milk;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.decorator.myimpl.dosing.Sugar;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Coffee</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Float price;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Sugar sugar;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Milk milk;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Chocolate chocolate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Float <span class="title function_">cost</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title function_">getDesc</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再来两个，美式咖啡和浓缩咖啡</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.decorator.myimpl.coffee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LongBlack</span> <span class="keyword">extends</span> <span class="title class_">Coffee</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LongBlack</span><span class="params">()</span> &#123;</span><br><span class="line">        setPrice(<span class="number">10F</span>);</span><br><span class="line">        setName(<span class="string">&quot;美式咖啡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Float <span class="title function_">cost</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Float</span> <span class="variable">price</span> <span class="operator">=</span> getPrice();</span><br><span class="line">        price += getSugar()==<span class="literal">null</span>? <span class="number">0F</span>: getSugar().getPrice();</span><br><span class="line">        price += getMilk()==<span class="literal">null</span>? <span class="number">0F</span>: getMilk().getPrice();</span><br><span class="line">        price += getChocolate()==<span class="literal">null</span>? <span class="number">0F</span>: getChocolate().getPrice();</span><br><span class="line">        <span class="keyword">return</span> price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDesc</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">desc</span> <span class="operator">=</span> getName();</span><br><span class="line">        <span class="keyword">if</span>(getSugar()!=<span class="literal">null</span>)</span><br><span class="line">            desc += <span class="string">&quot; &amp;&amp; &quot;</span> + getSugar().getName() + <span class="string">&quot; &quot;</span> + getSugar().getPrice();</span><br><span class="line">        <span class="keyword">if</span>(getMilk()!=<span class="literal">null</span>)</span><br><span class="line">            desc += <span class="string">&quot; &amp;&amp; &quot;</span> + getMilk().getName() + <span class="string">&quot; &quot;</span> + getMilk().getPrice();</span><br><span class="line">        <span class="keyword">if</span>(getChocolate()!=<span class="literal">null</span>)</span><br><span class="line">            desc += <span class="string">&quot; &amp;&amp; &quot;</span> + getChocolate().getName() + <span class="string">&quot; &quot;</span> + getChocolate().getPrice();</span><br><span class="line">        <span class="keyword">return</span> desc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.decorator.myimpl.coffee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Espresso</span> <span class="keyword">extends</span> <span class="title class_">Coffee</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Espresso</span><span class="params">()</span> &#123;</span><br><span class="line">        setPrice(<span class="number">8F</span>);</span><br><span class="line">        setName(<span class="string">&quot;浓缩咖啡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Float <span class="title function_">cost</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Float</span> <span class="variable">price</span> <span class="operator">=</span> getPrice();</span><br><span class="line">        price += getSugar()==<span class="literal">null</span>? <span class="number">0F</span>: getSugar().getPrice();</span><br><span class="line">        price += getMilk()==<span class="literal">null</span>? <span class="number">0F</span>: getMilk().getPrice();</span><br><span class="line">        price += getChocolate()==<span class="literal">null</span>? <span class="number">0F</span>: getChocolate().getPrice();</span><br><span class="line">        <span class="keyword">return</span> price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDesc</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">desc</span> <span class="operator">=</span> getName();</span><br><span class="line">        <span class="keyword">if</span>(getSugar()!=<span class="literal">null</span>)</span><br><span class="line">            desc += <span class="string">&quot; &amp;&amp; &quot;</span> + getSugar().getName() + <span class="string">&quot; &quot;</span> + getSugar().getPrice();</span><br><span class="line">        <span class="keyword">if</span>(getMilk()!=<span class="literal">null</span>)</span><br><span class="line">            desc += <span class="string">&quot; &amp;&amp; &quot;</span> + getMilk().getName() + <span class="string">&quot; &quot;</span> + getMilk().getPrice();</span><br><span class="line">        <span class="keyword">if</span>(getChocolate()!=<span class="literal">null</span>)</span><br><span class="line">            desc += <span class="string">&quot; &amp;&amp; &quot;</span> + getChocolate().getName() + <span class="string">&quot; &quot;</span> + getChocolate().getPrice();</span><br><span class="line">        <span class="keyword">return</span> desc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>基本已经完成，我们来进行测试一下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.decorator.myimpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.decorator.myimpl.coffee.Coffee;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.decorator.myimpl.coffee.Espresso;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.decorator.myimpl.coffee.LongBlack;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.decorator.myimpl.dosing.Chocolate;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.decorator.myimpl.dosing.Milk;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.decorator.myimpl.dosing.Sugar;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CoffeeShopMain</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">LongBlack</span> <span class="variable">longBlack</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LongBlack</span>();</span><br><span class="line">        longBlack.setMilk(<span class="keyword">new</span> <span class="title class_">Milk</span>());</span><br><span class="line">        longBlack.setSugar(<span class="keyword">new</span> <span class="title class_">Sugar</span>());</span><br><span class="line">        System.out.println(longBlack.getDesc());</span><br><span class="line">        System.out.println(<span class="string">&quot;金额是：&quot;</span> + longBlack.cost());</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;==================== 分割线 ====================&quot;</span>);</span><br><span class="line">        <span class="type">Coffee</span> <span class="variable">espresso</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Espresso</span>();</span><br><span class="line">        espresso.setMilk(<span class="keyword">new</span> <span class="title class_">Milk</span>());</span><br><span class="line">        espresso.setSugar(<span class="keyword">new</span> <span class="title class_">Sugar</span>());</span><br><span class="line">        espresso.setChocolate(<span class="keyword">new</span> <span class="title class_">Chocolate</span>());</span><br><span class="line">        System.out.println(espresso.getDesc());</span><br><span class="line">        System.out.println(<span class="string">&quot;金额是：&quot;</span> + espresso.cost());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220128205024.png" alt="image-20220128204948630" /></p>
<p>测试发现，咖啡选择，配料的添加，金额的计算没有出现问题。但如果从设计层面上讲，我这样写代码，绝对会被领导批，为什么？</p>
<p>试想一下，如果需求改变，添加了个豆浆的配料呢。好说，再加一个属性豆浆嘛，那这样就违反了开闭原则了，尽量不要修改到以前的代码。</p>
<blockquote>
<p>关于有人说可以将配料抽出一个接口或者抽象类，让咖啡持有一个List就好。其实我也有考虑过这样设计，简单方便。</p>
<p>这样的话，添加一个配料倒是没什么问题，如果添加的是包装费呢。如果把包装费也算作是配料的话，感觉不太对啊。</p>
<p>关键时刻还是得，装饰模式出场。</p>
</blockquote>
<h4 id="8-2）装饰模式实现">8.2）装饰模式实现</h4>
<p>装饰模式，其实就是封装主体，在外围包上一层，也可以包上多层。这每一层的包装，就是装饰。</p>
<p>如果是上面咖啡的例子的话，美式咖啡、浓缩咖啡就是<mark>被装饰的主体</mark>，而其他的配料就是装饰，需要什么配料包上去就行。</p>
<p>如何包装，这个是一个问题，我们先来看代码，需要一个抽象类，这和上面没有什么区别</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.decorator.optimize;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Drink</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Float price;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDesc</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> StrUtil.format(<span class="string">&quot;&#123;&#125; &#123;&#125;元&quot;</span>, name, price);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Float <span class="title function_">cost</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再来个咖啡的类，以及美式咖啡和浓缩咖啡</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.decorator.optimize.coffee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.decorator.optimize.Drink;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Coffee</span> <span class="keyword">extends</span> <span class="title class_">Drink</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Float <span class="title function_">cost</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getPrice();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.decorator.optimize.coffee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LongBlack</span> <span class="keyword">extends</span> <span class="title class_">Coffee</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LongBlack</span><span class="params">()</span> &#123;</span><br><span class="line">        setPrice(<span class="number">10F</span>);</span><br><span class="line">        setName(<span class="string">&quot;美式咖啡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.decorator.optimize.coffee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Espresso</span> <span class="keyword">extends</span> <span class="title class_">Coffee</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Espresso</span><span class="params">()</span> &#123;</span><br><span class="line">        setPrice(<span class="number">8F</span>);</span><br><span class="line">        setName(<span class="string">&quot;浓缩咖啡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面是咖啡，是被装饰的主体，接下来要编写装饰者</p>
<p>同样装饰者也需要继承<code>Drink</code>类，同时它还组合一个<code>Drink</code>的属性。这也就是说装饰者，必须有一个被装饰的主体</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.decorator.optimize;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Decorator</span> <span class="keyword">extends</span> <span class="title class_">Drink</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Drink drink;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Decorator</span><span class="params">(Drink drink)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.drink = drink;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDesc</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> StrUtil.format(<span class="string">&quot;&#123;&#125; | &#123;&#125;&quot;</span>, <span class="built_in">super</span>.getDesc(), drink.getDesc());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Float <span class="title function_">cost</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.getPrice() + drink.cost();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在编写装饰者的几个子类，在此例中，他们都是具体的调料。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.decorator.optimize.dosing;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.decorator.optimize.Decorator;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.decorator.optimize.Drink;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Chocolate</span> <span class="keyword">extends</span> <span class="title class_">Decorator</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Chocolate</span><span class="params">(Drink drink)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(drink);</span><br><span class="line">        setPrice(<span class="number">4F</span>);</span><br><span class="line">        setName(<span class="string">&quot;巧克力&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.decorator.optimize.dosing;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.decorator.optimize.Decorator;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.decorator.optimize.Drink;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Milk</span> <span class="keyword">extends</span> <span class="title class_">Decorator</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Milk</span><span class="params">(Drink drink)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(drink);</span><br><span class="line">        setPrice(<span class="number">3F</span>);</span><br><span class="line">        setName(<span class="string">&quot;牛奶&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.decorator.optimize.dosing;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.decorator.optimize.Decorator;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.decorator.optimize.Drink;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Sugar</span> <span class="keyword">extends</span> <span class="title class_">Decorator</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Sugar</span><span class="params">(Drink drink)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(drink);</span><br><span class="line">        setPrice(<span class="number">2F</span>);</span><br><span class="line">        setName(<span class="string">&quot;方糖&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如此一来，被装饰的主体和装饰者都已经写好了，马上来测试一下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.decorator.optimize;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.decorator.optimize.coffee.Espresso;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.decorator.optimize.coffee.LongBlack;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.decorator.optimize.dosing.Chocolate;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.decorator.optimize.dosing.Milk;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.decorator.optimize.dosing.Sugar;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CoffeeShopMain</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Drink</span> <span class="variable">longBlack</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LongBlack</span>();</span><br><span class="line">        longBlack = <span class="keyword">new</span> <span class="title class_">Milk</span>(longBlack);</span><br><span class="line">        longBlack = <span class="keyword">new</span> <span class="title class_">Sugar</span>(longBlack);</span><br><span class="line">        System.out.println(longBlack.getDesc());</span><br><span class="line">        System.out.println(<span class="string">&quot;金额是：&quot;</span> + longBlack.cost());</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;==================== 分割线 ====================&quot;</span>);</span><br><span class="line">        <span class="type">Drink</span> <span class="variable">espresso</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Espresso</span>();</span><br><span class="line">        espresso = <span class="keyword">new</span> <span class="title class_">Milk</span>(espresso);</span><br><span class="line">        espresso = <span class="keyword">new</span> <span class="title class_">Sugar</span>(espresso);</span><br><span class="line">        espresso = <span class="keyword">new</span> <span class="title class_">Chocolate</span>(espresso);</span><br><span class="line">        espresso = <span class="keyword">new</span> <span class="title class_">Chocolate</span>(espresso);<span class="comment">// 点两份巧克力</span></span><br><span class="line">        System.out.println(espresso.getDesc());</span><br><span class="line">        System.out.println(<span class="string">&quot;金额是：&quot;</span> + espresso.cost());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220129175946.png" alt="image-20220129175945539" /></p>
<p>简单画一个类图，他们的关系会是这样</p>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220129181825.png" alt="image-20220129181823631" /></p>
<p>按照上面的设计结构，如果是添加一个包装费，也很容易实现扩展。</p>
<p>只要将包装费弄成一个装饰者，马上实现产品的需求，而且对之前的结构没有产生任何影响。</p>
<blockquote>
<p>在jkd中，它的IO流就是使用的装饰模式，可以翻翻看。</p>
</blockquote>
<h3 id="9）组合模式">9）组合模式</h3>
<p>组合模式，又叫部分整体模式，是用于把一组相似的对象当作一个单一的对象。组合模式依据树形结构来组合对象，用来表示部分以及整体层次。这种类型的设计模式属于结构型模式，它创建了对象组的树形结构。</p>
<p>简单而言，就是多个结构，你中有我，我中有很多个他，他的心中又有许多人。每一个人都是部分，组合起来就是整体。这就是部分-整体的结构概念。</p>
<p>现在简单来看看这三个部分，学校、学院和专业。</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>这三个从学校开始，学校包含学院，学院包含专业</p>
</li>
<li class="lvl-2">
<p>支持学校增加删除学院，学院增加删除专业</p>
</li>
</ul>
<p>首先定义一个抽象类用来管理学校，学院和专业，让他们继承这个抽象类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.composite;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">OrganizationComponent</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;<span class="comment">// 名称</span></span><br><span class="line">    <span class="keyword">private</span> String desc;<span class="comment">// 简介</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(OrganizationComponent component)</span>&#123;</span><br><span class="line">        <span class="comment">// 默认实现，抛出不支持操作异常</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(OrganizationComponent component)</span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>学校、学院、专业</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.composite;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 学校</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">University</span> <span class="keyword">extends</span> <span class="title class_">OrganizationComponent</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;OrganizationComponent&gt; orgList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">University</span><span class="params">(String name, String desc)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name, desc);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(OrganizationComponent component)</span> &#123;</span><br><span class="line">        orgList.add(component);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(OrganizationComponent component)</span> &#123;</span><br><span class="line">        orgList.remove(component);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;===========&quot;</span> + getName() + <span class="string">&quot;===========&quot;</span>);</span><br><span class="line">        orgList.forEach(OrganizationComponent::show);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.composite;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 学院</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">College</span> <span class="keyword">extends</span> <span class="title class_">OrganizationComponent</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;OrganizationComponent&gt; orgList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">College</span><span class="params">(String name, String desc)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name, desc);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(OrganizationComponent component)</span> &#123;</span><br><span class="line">        System.out.println(StrUtil.format(<span class="string">&quot;&#123;&#125;添加了《&#123;&#125;》专业&quot;</span>, getName(), component.getName()));</span><br><span class="line">        orgList.add(component);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(OrganizationComponent component)</span> &#123;</span><br><span class="line">        System.out.println(StrUtil.format(<span class="string">&quot;&#123;&#125;移除了《&#123;&#125;》专业&quot;</span>, getName(), component.getName()));</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> orgList.remove(component);</span><br><span class="line">        <span class="keyword">if</span>(!b)</span><br><span class="line">            System.out.println(StrUtil.format(<span class="string">&quot;笑死，根本就没有《&#123;&#125;》这个专业&quot;</span>, component.getName()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;===========&quot;</span> + getName() + <span class="string">&quot;===========&quot;</span>);</span><br><span class="line">        orgList.forEach(OrganizationComponent::show);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.composite;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 专业</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Specialty</span> <span class="keyword">extends</span> <span class="title class_">OrganizationComponent</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Specialty</span><span class="params">(String name, String desc)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name, desc);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(StrUtil.format(<span class="string">&quot;&#123;&#125; =&gt; &#123;&#125;&quot;</span>, getName(), getDesc()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述就已经完成组合的结构了，写段代码来测试一下效果</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.composite;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CompositeMain</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">University</span> <span class="variable">university</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">University</span>(<span class="string">&quot;清华大学&quot;</span>, <span class="string">&quot;清华大学&quot;</span>);</span><br><span class="line">        <span class="type">College</span> <span class="variable">collegeA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">College</span>(<span class="string">&quot;计算机学院&quot;</span>, <span class="string">&quot;计算机学院&quot;</span>);</span><br><span class="line">        <span class="type">College</span> <span class="variable">collegeB</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">College</span>(<span class="string">&quot;信息工程学院&quot;</span>, <span class="string">&quot;信息工程学院&quot;</span>);</span><br><span class="line">        university.add(collegeA);</span><br><span class="line">        university.add(collegeB);</span><br><span class="line">        collegeA.add(<span class="keyword">new</span> <span class="title class_">Specialty</span>(<span class="string">&quot;软件工程&quot;</span>, <span class="string">&quot;软件工程掉头发啊&quot;</span>));</span><br><span class="line">        collegeA.add(<span class="keyword">new</span> <span class="title class_">Specialty</span>(<span class="string">&quot;网络工程&quot;</span>, <span class="string">&quot;网络工程掉头发啊&quot;</span>));</span><br><span class="line">        collegeA.add(<span class="keyword">new</span> <span class="title class_">Specialty</span>(<span class="string">&quot;计算机科学技术&quot;</span>, <span class="string">&quot;计算机科学技术掉头发啊&quot;</span>));</span><br><span class="line">        collegeB.add(<span class="keyword">new</span> <span class="title class_">Specialty</span>(<span class="string">&quot;通信工程&quot;</span>, <span class="string">&quot;通信工程掉头发啊&quot;</span>));</span><br><span class="line">        collegeB.add(<span class="keyword">new</span> <span class="title class_">Specialty</span>(<span class="string">&quot;信息工程&quot;</span>, <span class="string">&quot;信息工程掉头发啊&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 查看学校的信息</span></span><br><span class="line">        university.show();</span><br><span class="line">        <span class="comment">// 只查看其他的院系</span></span><br><span class="line"><span class="comment">//        collegeA.show();</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220208222807.png" alt="image-20220208222806004" /></p>
<p>同样，我也可以从学院进行展示</p>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220208222937.png" alt="image-20220208222936458" /></p>
<h3 id="10）外观模式">10）外观模式</h3>
<p>在现实生活中，常常存在办事较复杂的例子。如办理什么证件，需要这的那的一大堆材料，有时要同多个部门联系，这时要是有一个综合部门能解决一切手续问题就好了。</p>
<p>软件设计也是这样，一个大的功能下，包含了许多子功能。尽量不要让客户端知道里面的细节，也能可以将事情办成。在一系列复杂的操作上再加上一层，这就是外观模式，也叫<mark>过程模式</mark>。</p>
<p>简单看下这个场景，电脑的开关机。我们知道电脑中有cpu，硬盘，内存，显卡等，但我们不关心内部具体的启动，只需要在机箱上点击启动键。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.facade;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ComputerComponent</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">open</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.facade;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cpu</span> <span class="keyword">implements</span> <span class="title class_">ComputerComponent</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">open</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;cpu启动&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;cpu关闭&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.facade;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Ddr</span> <span class="keyword">implements</span> <span class="title class_">ComputerComponent</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">open</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;内存启动&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;内存关闭&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.facade;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PowerSupply</span> <span class="keyword">implements</span> <span class="title class_">ComputerComponent</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">open</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;接通电源&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;关闭电源&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.facade;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Ssd</span> <span class="keyword">implements</span> <span class="title class_">ComputerComponent</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">open</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;硬盘启动&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;硬盘关闭&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再写一个外观类，通过组合的方式将内部组件配在一起</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.facade;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ComputerFacade</span> <span class="keyword">implements</span> <span class="title class_">ComputerComponent</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Cpu cpu;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Ddr ddr;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> PowerSupply ps;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Ssd ssd;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ComputerFacade</span><span class="params">()</span> &#123;</span><br><span class="line">        cpu = <span class="keyword">new</span> <span class="title class_">Cpu</span>();</span><br><span class="line">        ddr = <span class="keyword">new</span> <span class="title class_">Ddr</span>();</span><br><span class="line">        ps = <span class="keyword">new</span> <span class="title class_">PowerSupply</span>();</span><br><span class="line">        ssd = <span class="keyword">new</span> <span class="title class_">Ssd</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">open</span><span class="params">()</span> &#123;</span><br><span class="line">        ps.open();</span><br><span class="line">        cpu.open();</span><br><span class="line">        ddr.open();</span><br><span class="line">        ssd.open();</span><br><span class="line">        System.out.println(<span class="string">&quot;==== 电脑启动成功 ====&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> &#123;</span><br><span class="line">        ddr.close();</span><br><span class="line">        cpu.close();</span><br><span class="line">        ssd.close();</span><br><span class="line">        ps.close();</span><br><span class="line">        System.out.println(<span class="string">&quot;==== 电脑关闭成功 ====&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>来个客户端进行开关机吧</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.facade;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FacadeMain</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ComputerFacade</span> <span class="variable">computerFacade</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ComputerFacade</span>();</span><br><span class="line">        <span class="comment">// 开启</span></span><br><span class="line">        computerFacade.open();</span><br><span class="line">        <span class="comment">// 关闭</span></span><br><span class="line">        computerFacade.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/facade.png" alt="image-20220212123701372" /></p>
<blockquote>
<p>外观模式和工厂模式的区别。有些人不理解，但这其实很好理解。</p>
<p>外观模式是过程，大动作里面有一系列的小动作，将这些小动作进行封装，形成的就是外观模式。</p>
<p>工厂模式是实例结果，为了得到这个对象，里面封装的许多对象的细节，这就是工厂模式。</p>
<p>虽然都在外部包上了一层，但结构型和创建型的区别就在这里。</p>
</blockquote>
<h3 id="11）享元模式">11）享元模式</h3>
<p>享元模式，主要用于减少创建对象的数量，以减少内存占用和提高性能。这种模式在我们的代码中经常用到，比如说连接池，或者线程池，这池子就是一个享元模式。</p>
<p>比如说，我们可以看下面这个五子棋例子，棋盘和下棋的一段示例代码。</p>
<p>棋子类，有个颜色的属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.flyweight;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChessPieces</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再来一个工厂类，让工厂类去控制棋子类的生产</p>
<blockquote>
<p>与前面讲到的工厂类有点区别</p>
<p>享元模式的这个会将生产出来的棋子实例放入容器中，后续有需要将从这个容器中去取，从而控制棋子的实例数量。</p>
<p>上面工厂模式是只管创建，外部需要，工厂就创建一个新的实例进行返回</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.flyweight;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChessPiecesFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, ChessPieces&gt; chessPiecesContainer = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ChessPieces <span class="title function_">getChessPieces</span><span class="params">(String type)</span>&#123;</span><br><span class="line">        <span class="type">ChessPieces</span> <span class="variable">chessPieces</span> <span class="operator">=</span> chessPiecesContainer.get(type);</span><br><span class="line">        <span class="keyword">if</span>(!chessPiecesContainer.containsKey(type))&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">&quot;white&quot;</span>.equals(type))&#123;</span><br><span class="line">                chessPieces = <span class="keyword">new</span> <span class="title class_">ChessPieces</span>(<span class="string">&quot;白&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;black&quot;</span>.equals(type))&#123;</span><br><span class="line">                chessPieces = <span class="keyword">new</span> <span class="title class_">ChessPieces</span>(<span class="string">&quot;黑&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            chessPiecesContainer.put(type, chessPieces);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> chessPieces;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再来一个棋盘类，里面有落子和展示的方法，暂时不要管重复落子的BUG</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.flyweight;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.rmi.activation.UnknownObjectException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Chessboard</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ChessPieces[][] chessboard = <span class="keyword">new</span> <span class="title class_">ChessPieces</span>[<span class="number">19</span>][<span class="number">19</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">ChessPiecesFactory</span> <span class="variable">chessPiecesFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChessPiecesFactory</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, String type)</span> <span class="keyword">throws</span> UnknownObjectException &#123;</span><br><span class="line">        <span class="keyword">if</span>(x&lt;<span class="number">0</span> || x&gt;<span class="number">18</span> || y&lt;<span class="number">0</span> || y&gt;<span class="number">18</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>(<span class="string">&quot;不能在此落子&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(!<span class="string">&quot;white&quot;</span>.equals(type) &amp;&amp; !<span class="string">&quot;black&quot;</span>.equals(type))</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnknownObjectException</span>(<span class="string">&quot;未知的棋子&quot;</span>);</span><br><span class="line">        chessboard[x][y] = chessPiecesFactory.getChessPieces(type);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showChessboard</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; chessboard.length; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (ChessPieces chessPieces : chessboard[i]) &#123;</span><br><span class="line">                <span class="keyword">if</span>(chessPieces!=<span class="literal">null</span>)</span><br><span class="line">                    System.out.print(chessPieces.getColor());</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    System.out.print(<span class="string">&quot;空&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>写段代码测试一下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.flyweight;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.rmi.activation.UnknownObjectException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FlyweightMain</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> UnknownObjectException &#123;</span><br><span class="line">        <span class="type">Chessboard</span> <span class="variable">chessboard</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Chessboard</span>();</span><br><span class="line">        chessboard.put(<span class="number">0</span>, <span class="number">0</span>, <span class="string">&quot;black&quot;</span>);</span><br><span class="line">        chessboard.put(<span class="number">0</span>, <span class="number">1</span>, <span class="string">&quot;black&quot;</span>);</span><br><span class="line">        chessboard.put(<span class="number">1</span>, <span class="number">0</span>, <span class="string">&quot;white&quot;</span>);</span><br><span class="line">        chessboard.put(<span class="number">1</span>, <span class="number">1</span>, <span class="string">&quot;white&quot;</span>);</span><br><span class="line">        System.out.println(chessboard.chessboard[<span class="number">0</span>][<span class="number">0</span>] == chessboard.chessboard[<span class="number">0</span>][<span class="number">1</span>]);</span><br><span class="line">        System.out.println(chessboard.chessboard[<span class="number">1</span>][<span class="number">0</span>] == chessboard.chessboard[<span class="number">1</span>][<span class="number">1</span>]);</span><br><span class="line"><span class="comment">//        chessboard.showChessboard();</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查看结果，大家也可以将<code>showChessboard()</code>展示出来看看效果</p>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220214195013.png" alt="image-20220214195011770" /></p>
<p>在此处，需要区分对象实例的内部属性和外部属性。在此处，内部属性就是颜色，外部属性就是坐标的x和y，将两者进行区分，否则会造成系统的混乱。</p>
<blockquote>
<p>在jdk中，我们常用的Integer就使用到了享元模式。对的，就是那个缓存，具体可以看看源码，和本文的示例不同，但也是享元模式的思想。</p>
</blockquote>
<h3 id="12）代理模式">12）代理模式</h3>
<p>代理模式，大家肯定很熟悉了，它也是属于结构型设计模式的一种，对原本的功能做出的一种增强，而不用影响到原来的代码。</p>
<p>简单的来说，是为目标对象提供一个代替的对象，称之为替身。我们通过使用替身来进行访问目标对象的一些方法。如此一来，我们在替身上就可以做出一些额外的操作，也就是功能增强。</p>
<p>代理模式的分类可以分为两种</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>静态代理：是我们编写出的结构型代理，编译完成后，就存在有替身的class文件</p>
</li>
<li class="lvl-2">
<p>动态代理：在内存中动态为对象创建替身</p>
<ul class="lvl-2">
<li class="lvl-4">JDK代理：又叫接口代理</li>
<li class="lvl-4">Cglib代理</li>
</ul>
</li>
</ul>
<h4 id="12-1）静态代理">12.1）静态代理</h4>
<p>静态代理，目标类和替身类实现同一个接口，替身类再重写的方法中去调用目标类的方法。</p>
<p>先简单来个接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.proxy.staticproxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ITeacher</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">teach</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再有一个它的实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.proxy.staticproxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Teacher</span> <span class="keyword">implements</span> <span class="title class_">ITeacher</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">teach</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;老师授课中&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在代理对象出场，它聚合了目标对象。这里可以选择组合也没有问题</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.proxy.staticproxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TeacherProxy</span> <span class="keyword">implements</span> <span class="title class_">ITeacher</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Teacher teacherDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">teach</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;上课铃声响了&quot;</span>);</span><br><span class="line">        teacherDao.teach();</span><br><span class="line">        System.out.println(<span class="string">&quot;下课铃声响了&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;老师开始布置作业&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在简单使用一下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.proxy.staticproxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StaticProxyMain</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">TeacherProxy</span> <span class="variable">proxy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TeacherProxy</span>(<span class="keyword">new</span> <span class="title class_">Teacher</span>());</span><br><span class="line">        proxy.teach();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220214222820-proxy.png" alt="image-20220214222818655" /></p>
<p>静态代理平常不怎么使用，因为实在过于繁杂。这就有了动态代理</p>
<h4 id="12-2）动态代理之jdk代理">12.2）动态代理之jdk代理</h4>
<p>jdk动态代理，是使用了jdk中的一个api，代理需要<code>java.lang.reflect.InvocationHandler</code>接口和 <code>java.lang.reflect.Proxy</code>类，以及它生产代理类的核心方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">newProxyInstance</span><span class="params">(ClassLoader loader,</span></span><br><span class="line"><span class="params">                                          Class&lt;?&gt;[] interfaces,</span></span><br><span class="line"><span class="params">                                          InvocationHandler h)</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 简单说明一下几个参数</span></span><br><span class="line"><span class="comment"> * ClassLoader loader：指定目标对象的类加载器，获取加载器的方式是固定的</span></span><br><span class="line"><span class="comment"> * Class&lt;?&gt;[] interfaces：目标对象实现的接口类型数组</span></span><br><span class="line"><span class="comment"> * InvocationHandler h：事件处理，执行目标对象方法时，会触发此执行器的方法。函数式接口，该接口只有一个方法</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>
<p>照样我们将上面静态代理改成jdk代理的方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.proxy.jdkproxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ITeacher</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">teach</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.proxy.jdkproxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Teacher</span> <span class="keyword">implements</span> <span class="title class_">ITeacher</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">teach</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;老师授课中&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编写一个工厂类，将需要代理的对象传入，工厂会生产出这个对象的代理对象的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.proxy.jdkproxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdkProxyFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object target;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JdkProxyFactory</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getProxyInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// 简化使用了lambda表达式，需要大家能看懂</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">proxyInstance</span> <span class="operator">=</span> Proxy.newProxyInstance(target.getClass().getClassLoader(),</span><br><span class="line">                target.getClass().getInterfaces(),</span><br><span class="line">                (p, m, args) -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;JDK代理开始&quot;</span>);</span><br><span class="line">                    <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> m.invoke(target, args);</span><br><span class="line">                    System.out.println(<span class="string">&quot;后置作业通知&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span> result;</span><br><span class="line">                &#125;</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> proxyInstance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>写完了，我们来测试一下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.proxy.jdkproxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdkProxyMain</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建目标对象</span></span><br><span class="line">        <span class="type">ITeacher</span> <span class="variable">teacher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Teacher</span>();</span><br><span class="line">        <span class="comment">// 将目标对象传入，让其工厂生产代理对象</span></span><br><span class="line">        <span class="type">ITeacher</span> <span class="variable">teacherProxy</span> <span class="operator">=</span> (ITeacher) <span class="keyword">new</span> <span class="title class_">JdkProxyFactory</span>(teacher).getProxyInstance();</span><br><span class="line">        <span class="comment">// 查看代理对象Class</span></span><br><span class="line">        System.out.println(<span class="string">&quot;teacherProxy：&quot;</span> + teacherProxy.getClass());</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;============ 分割线 ============&quot;</span>);</span><br><span class="line">        <span class="comment">// 调用代理对象teach方法</span></span><br><span class="line">        teacherProxy.teach();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220215214735.png" alt="image-20220215214732944" /></p>
<p>可以看到结果，目标对象成功被代理，而<code>teacherProxy</code>对象就是其代理对象，大家可以看看它的包路径，是jdk动态生成的。</p>
<h4 id="12-3）动态代理之Cglib代理">12.3）动态代理之Cglib代理</h4>
<p>前面的两种代理方式都需要目标对象是有实现一个接口的，但有时候目标对象仅仅只是一个对象，没有实现任何接口。这时候就需要Cglib代理了。</p>
<p>如何选择代理模式</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>目标对象实现了接口，可以使用jdk代理</p>
</li>
<li class="lvl-2">
<p>目标对象没有实现接口，用Cglib代理，更推荐</p>
</li>
</ul>
<p>Cglib时一个强大的高性能的代码生成包，它的底层是通过使用字节码处理框架ASM来转换字节码并生成新的类。所以，就保证了Java在运行时，可以扩展Java的类。它被广泛的运用到其他AOP框架中，如Spring AOP。</p>
<p>Cglib代理又称为<mark>子类代理</mark>，所以对目标对象有了一定的限制</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>目标对象的class不能是final类</p>
</li>
<li class="lvl-2">
<p>目标对象中<code>final</code>和<code>static</code>方法，不能被拦截代理</p>
</li>
</ul>
<p>引入包依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>继续演示教师的例子，这次没有教师接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.proxy.cglibproxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Teacher</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">teach</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;老师授课中&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现<code>MethodInterceptor</code>接口，并重写，这个相当于jdk代理的<code>InvocationHandler</code>接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.proxy.cglibproxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.Enhancer;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.MethodInterceptor;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.MethodProxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CglibProxyFactory</span> <span class="keyword">implements</span> <span class="title class_">MethodInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object target;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CglibProxyFactory</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getProxyInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// 1、创建工具类</span></span><br><span class="line">        <span class="type">Enhancer</span> <span class="variable">enhancer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Enhancer</span>();</span><br><span class="line">        <span class="comment">// 2、设置父类</span></span><br><span class="line">        enhancer.setSuperclass(target.getClass());</span><br><span class="line">        <span class="comment">// 3、设置回调函数，实现了MethodInterceptor的类对象实例，这里传入this</span></span><br><span class="line">        enhancer.setCallback(<span class="built_in">this</span>);</span><br><span class="line">        <span class="comment">// 4、创建子类对象，即代理对象</span></span><br><span class="line">        <span class="keyword">return</span> enhancer.create();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Object o, Method method, Object[] args, MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Cglib代理 开始&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(target, args);</span><br><span class="line">        System.out.println(<span class="string">&quot;Cglib代理 后置通知&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>简单测试一下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.proxy.cglibproxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CglibProxyMain</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Teacher</span> <span class="variable">teacher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Teacher</span>();</span><br><span class="line">        <span class="type">Teacher</span> <span class="variable">teacherProxy</span> <span class="operator">=</span> (Teacher) <span class="keyword">new</span> <span class="title class_">CglibProxyFactory</span>(teacher).getProxyInstance();</span><br><span class="line">        System.out.println(<span class="string">&quot;teacherProxy：&quot;</span> + teacherProxy.getClass());</span><br><span class="line">        teacherProxy.teach();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220215231904.png" alt="image-20220215231902753" /></p>
<blockquote>
<p>在日常的项目中，我们常常使用Spring AOP比较多，这个功能可以单独出一篇文章来进行讲解使用。</p>
</blockquote>
<h2 id="五、行为型设计模式">五、行为型设计模式</h2>
<h3 id="13）模板模式">13）模板模式</h3>
<p>模板模式，又称为模板方法模式。它定义了一套流程，有一定的实现步骤，就和模板一样。只是其中有些方法在模板中不清楚，所以将这些方法让子类去进行实现，子类继承模板类并重写关键的几个方法。这就是模板模式，是行为型设计模式的一种。</p>
<p>基本上，模板类是一个抽象类，负责封装了一个模板方法和其他多个基本方法组成。</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>模板方法：在此方法中按照一定的顺序调用了其他基本方法</p>
</li>
<li class="lvl-2">
<p>基本方法：除模板方法外的其他方法</p>
<ul class="lvl-2">
<li class="lvl-4">抽象方法：模板定义的抽象方法，需要由子类继续实现的方法</li>
<li class="lvl-4">具体方法：模板中已经定义实现，必要时在子类中可以重写它</li>
<li class="lvl-4">钩子方法：模板中已经定义实现，此类方法用于判断，必要时在子类中可以重写它</li>
</ul>
</li>
</ul>
<p>在日常生活中，我们常常去医院挂号看病，大致的流程都是一样的吧，挂号，就诊，获取诊单，签字付钱，手术，康复，出院……根据这样一个流程，我们可以把这些步骤弄成一个模板类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.template;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">HospitalTemplate</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 模板方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">goHospital</span><span class="params">()</span>&#123;</span><br><span class="line">        registration();</span><br><span class="line">        seeADoctor();</span><br><span class="line">        <span class="keyword">if</span>(getOrder()&gt;<span class="number">5</span>)&#123;</span><br><span class="line">            payMoney();</span><br><span class="line">            operation();</span><br><span class="line">            recovery();</span><br><span class="line">        &#125;</span><br><span class="line">        leaveHospital();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registration</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;挂号成功，等待就诊中~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">seeADoctor</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;正在就诊中~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">payMoney</span><span class="params">()</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation</span><span class="params">()</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recovery</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;康复了，好开心~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">leaveHospital</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;终于离开这该死的医院了~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>来一个黑心医院</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.template;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DirtyHospital</span> <span class="keyword">extends</span> <span class="title class_">HospitalTemplate</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;医生心中暗喜，冤大头来了&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">8</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">payMoney</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;支付医疗费用 $2333333&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;麻醉，简单输了点葡萄糖~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再来一个公共医院</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.template;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonHospital</span> <span class="keyword">extends</span> <span class="title class_">HospitalTemplate</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registration</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;挂号，收取费用￥5&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">seeADoctor</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;医生认真检查中~&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;医生并未发现疾病隐患&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">leaveHospital</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;走喽~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>来写段代码测试一下上面两个医院</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.template;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TemplateMain</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">DirtyHospital</span> <span class="variable">dirtyHospital</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DirtyHospital</span>();</span><br><span class="line">        dirtyHospital.goHospital();</span><br><span class="line">        System.out.println(<span class="string">&quot;=========== 分割线 ===========&quot;</span>);</span><br><span class="line">        <span class="type">CommonHospital</span> <span class="variable">commonHospital</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CommonHospital</span>();</span><br><span class="line">        commonHospital.goHospital();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220216233905.png" alt="image-20220216233904361" /></p>
<blockquote>
<p>在学习的过程中，我发现许多弹幕说模板方法模式不就是建造者模式吗，也有的弹幕说是外观模式。<s>这不是一样的吗，这样也能挣到钱，我真的是</s>。他们肯定没有多想，为什么设计模式会分类型，来看看它们的区别吧。</p>
<p><b>模板方法模式、建造者和外观模式的区别</b></p>
<ul class="lvl-1">
<li class="lvl-2">
<p>建造者模式：这是一个构造型设计模式，重点在于提供细节<mark>构建出一个对象实例</mark>。</p>
</li>
<li class="lvl-2">
<p>外观模式：这是一个结构型设计模式，将许多的类封装出一个外观类，通过这个外观类从而<mark>省略掉客户端一系列麻烦的操作</mark>。上面我举的例子是电脑主机，有CPU、显卡、内存和电源这些类，而外观类相当于机箱，客户端只对机箱进行使用。</p>
</li>
<li class="lvl-2">
<p>模板方法模式：这是一个行为型设计模式，主要在于行为，模板类规定了模板方法，其他方法有的自己默认实现，有的则交给具体的子类去实现，这就是行为不同。由此看来，<mark>子类是模板类行为的扩展</mark>，是这个模板的具体例子。</p>
</li>
</ul>
</blockquote>
<h3 id="14）命令模式">14）命令模式</h3>
<p>在日常的生活中，我们总扮演者两种角色，官府和小吏，领导和员工，分为了指挥的人和做事的人，而在他们之间是一道命令。在程序中，也是有发起者和执行者，所以命令模式，就是将发起者和执行者进行解耦。</p>
<blockquote>
<p>如何解耦，我们可以看看这个例子。将军调兵的场景，按理说将军可以直接命令军队，但现在不同，需要一道有虎符的军令。军队不听将军，只听这道有虎符的军令。所以解耦，这中间层就是命令。</p>
</blockquote>
<p>上面例子对应的几个角色：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><b>请求者（Invoker）</b>：命令的发起人，在上面的例子就是将军</p>
</li>
<li class="lvl-2">
<p><b>接收者（Receiver）</b>：具体的执行者，执行的方法叫做行动方法，如上例子便是军队</p>
</li>
<li class="lvl-2">
<p><b>命令（Command）</b>：命令的抽象类或者接口，军令</p>
</li>
<li class="lvl-2">
<p><b>具体命令（ConcreteCommand）</b>：具体的命令，负责调用接收者的行动方法。在上面没有特别举例，这是一个具体的军令，如列阵、行军等具体的军令</p>
</li>
</ul>
<p>根据上面的例子，我们来写写看具体的代码。先简单写个命令抽象类当做军令</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.command;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 军令</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Command</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 执行方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>等等再写具体的军令，先写出接受者，也就是军队。里面有两个行动方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.command;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 军队</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Army</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Army</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">advance</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="built_in">this</span>.name + <span class="string">&quot;正在向前方冲锋&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">retreat</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="built_in">this</span>.name + <span class="string">&quot;正在有序撤退&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在可以写出具体的军令了，命令要聚合一个军队进去</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.command;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 冲锋命令</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdvanceCommand</span> <span class="keyword">implements</span> <span class="title class_">Command</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Army army;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AdvanceCommand</span><span class="params">(Army army)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.army = army;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line">        army.advance();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.command;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 撤退命令</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RetreatCommand</span> <span class="keyword">implements</span> <span class="title class_">Command</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Army army;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RetreatCommand</span><span class="params">(Army army)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.army = army;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line">        army.retreat();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样一来，就只差个请求者了。嗯对，缺一个将军</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.command;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将军</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">General</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Army&gt; armyList;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">General</span><span class="params">()</span> &#123;</span><br><span class="line">        armyList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Army&gt;()&#123;&#123;</span><br><span class="line">            add(<span class="keyword">new</span> <span class="title class_">Army</span>(<span class="string">&quot;调查兵团&quot;</span>));</span><br><span class="line">            add(<span class="keyword">new</span> <span class="title class_">Army</span>(<span class="string">&quot;宪兵团&quot;</span>));</span><br><span class="line">            add(<span class="keyword">new</span> <span class="title class_">Army</span>(<span class="string">&quot;驻扎兵团&quot;</span>));</span><br><span class="line">        &#125;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">advance</span><span class="params">(<span class="type">int</span> i)</span>&#123;</span><br><span class="line">        <span class="type">AdvanceCommand</span> <span class="variable">advanceCommand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AdvanceCommand</span>(armyList.get(i));</span><br><span class="line">        advanceCommand.execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">retreat</span><span class="params">(<span class="type">int</span> i)</span>&#123;</span><br><span class="line">        <span class="type">RetreatCommand</span> <span class="variable">retreatCommand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RetreatCommand</span>(armyList.get(i));</span><br><span class="line">        retreatCommand.execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>写段代码测试一下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.command;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommandMain</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">General</span> <span class="variable">general</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">General</span>();</span><br><span class="line">        general.advance(<span class="number">0</span>);</span><br><span class="line">        general.advance(<span class="number">1</span>);</span><br><span class="line">        general.advance(<span class="number">2</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;======== 分割线 ========&quot;</span>);</span><br><span class="line">        general.retreat(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220219133432command.png" alt="image-20220219133430683" /></p>
<blockquote>
<p>代码写完了，但有一段时间我还是迷茫的。我没有立马想到这个模式的使用场景，考虑不到具体的编码业务场景</p>
<p>后来看了网上许多示例写的都是什么遥控器，比如说我有一个万能遥控器，可以控制顶灯、空调、窗帘等许多物品。我乍一听这不该是外观模式吗？</p>
<p>上面举例的几个物品支持开关操作对吧，如果是外观模式，遥控器这个外观类上就会有m*n个方法，去控制物品的开和关。</p>
<p>但只要使用了命令模式，因为物品只有开和关两个操作，所以我们只需要在遥控器上写两个方法即可。</p>
<p>至此，我才能理解命令模式的思想和它带来的便捷。<img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220219134617.png" alt="image-20220219134605904" style="zoom:25%;" /></p>
</blockquote>
<h3 id="15）访问者模式">15）访问者模式</h3>
<p>首先，我们先来看一个场景。</p>
<p>比方说在一个歌手选秀现场，评委和现场观众都要对歌手进行打分。打分是一种操作，其他的操作还有直接晋级，直接淘汰。</p>
<p>在开始，选秀节目不够有互动性，仅有三个操作还不太够。结果后来再多出了一个操作，复活评分。</p>
<p>经过这次甜头，导演难免又要瞎整什么骚操作了。你是架构师，该如何设计程序架构对应对付以上导演的刁难。</p>
<p>别慌，访问者可以解决这个问题，这个设计模式针对的是对象不变，但操作频繁扩展的情况。我们先来看看对应的几个角色定义</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><b>访问者（Visitor）</b>：</p>
<ul class="lvl-2">
<li class="lvl-4">访问者定义为接口或者抽象类，它的几个实现类对应具体的操作。</li>
<li class="lvl-4">按理来说，它的参数是一个具体的元素，每一个具体的元素都应该有一个自己的方法。</li>
<li class="lvl-4">对应上边例子的打分、直接复活等操作</li>
</ul>
</li>
<li class="lvl-2">
<p><b>元素（Element）</b>：</p>
<ul class="lvl-2">
<li class="lvl-4">元素，本来是操作具体的实施角色，但由于操作被抽离出去变成了访问者，那么元素就仅仅只是个操作的发起者而已了。</li>
<li class="lvl-4">它定义了一个接受访问者的一个<code>accept</code>方法，指的是每个元素都可以被访问者访问。</li>
<li class="lvl-4">对应上边例子就是评委和现场观众</li>
</ul>
</li>
<li class="lvl-2">
<p><b>ObjectStructure</b>：用来管理元素的一个类，可以有也可以无</p>
</li>
</ul>
<p>我们先来定义一下元素这个角色的抽象类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.visitor.element;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.visitor.visitor.Operation;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 元素（Element）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(Operation operation)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再定义一下访问者的抽象类吧</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.visitor.visitor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.visitor.element.Judge;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.visitor.element.Spectator;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 访问者</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Operation</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">operation</span><span class="params">(Judge judge)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">operation</span><span class="params">(Spectator spectator)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样，访问者和元素就聚合在一起了，我们再来写出它们的子类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.visitor.element;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.visitor.visitor.Operation;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 评委</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Judge</span> <span class="keyword">extends</span> <span class="title class_">Person</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Judge</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(Operation operation)</span> &#123;</span><br><span class="line">        operation.operation(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.visitor.element;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.visitor.visitor.Operation;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 现场观众</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Spectator</span> <span class="keyword">extends</span> <span class="title class_">Person</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Spectator</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(Operation operation)</span> &#123;</span><br><span class="line">        operation.operation(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>访问者的几个子类操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.visitor.visitor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.visitor.element.Judge;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.visitor.element.Spectator;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 打分</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GradeOperation</span> <span class="keyword">extends</span> <span class="title class_">Operation</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation</span><span class="params">(Judge judge)</span> &#123;</span><br><span class="line">        System.out.println(judge.getName() + <span class="string">&quot;正在打分&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation</span><span class="params">(Spectator spectator)</span> &#123;</span><br><span class="line">        System.out.println(spectator.getName() + <span class="string">&quot;正在打分&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.visitor.visitor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.visitor.element.Judge;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.visitor.element.Spectator;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 直接晋级</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RiseOperation</span> <span class="keyword">extends</span> <span class="title class_">Operation</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation</span><span class="params">(Judge judge)</span> &#123;</span><br><span class="line">        System.out.println(judge.getName() + <span class="string">&quot;推荐歌手直接晋级&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation</span><span class="params">(Spectator spectator)</span> &#123;</span><br><span class="line">        System.out.println(spectator.getName() + <span class="string">&quot;推荐歌手直接晋级&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.visitor.visitor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.visitor.element.Judge;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.visitor.element.Spectator;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 淘汰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WeedOutOperation</span> <span class="keyword">extends</span> <span class="title class_">Operation</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation</span><span class="params">(Judge judge)</span> &#123;</span><br><span class="line">        System.out.println(judge.getName() + <span class="string">&quot;建议歌手直接淘汰&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operation</span><span class="params">(Spectator spectator)</span> &#123;</span><br><span class="line">        System.out.println(spectator.getName() + <span class="string">&quot;建议歌手直接淘汰&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再来一个<code>ObjectStructure</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.visitor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.visitor.element.Judge;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.visitor.element.Person;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.visitor.element.Spectator;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.visitor.visitor.Operation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ObjectStructure</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Person&gt; personElementList;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ObjectStructure</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.personElementList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="built_in">this</span>.personElementList.add(<span class="keyword">new</span> <span class="title class_">Judge</span>(<span class="string">&quot;评委A&quot;</span>));</span><br><span class="line">        <span class="built_in">this</span>.personElementList.add(<span class="keyword">new</span> <span class="title class_">Judge</span>(<span class="string">&quot;评委B&quot;</span>));</span><br><span class="line">        <span class="built_in">this</span>.personElementList.add(<span class="keyword">new</span> <span class="title class_">Judge</span>(<span class="string">&quot;评委C&quot;</span>));</span><br><span class="line">        <span class="built_in">this</span>.personElementList.add(<span class="keyword">new</span> <span class="title class_">Spectator</span>(<span class="string">&quot;观众甲&quot;</span>));</span><br><span class="line">        <span class="built_in">this</span>.personElementList.add(<span class="keyword">new</span> <span class="title class_">Spectator</span>(<span class="string">&quot;观众乙&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Person person)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.personElementList.add(person);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Person <span class="title function_">remove</span><span class="params">(Person person)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.remove(person);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(Operation operation, <span class="type">int</span> index)</span>&#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="built_in">this</span>.personElementList.get(index);</span><br><span class="line">        <span class="keyword">if</span>(person==<span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>();</span><br><span class="line">        person.accept(operation);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这边你可以继续继承操作来试试，我们先来测试下当前的效果</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.visitor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.banmoon.visitor.visitor.GradeOperation;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.visitor.visitor.RiseOperation;</span><br><span class="line"><span class="keyword">import</span> com.banmoon.visitor.visitor.WeedOutOperation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VisitorMain</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ObjectStructure</span> <span class="variable">objectStructure</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectStructure</span>();</span><br><span class="line">        <span class="type">GradeOperation</span> <span class="variable">gradeOperation</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GradeOperation</span>();</span><br><span class="line">        <span class="type">WeedOutOperation</span> <span class="variable">weedOutOperation</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WeedOutOperation</span>();</span><br><span class="line">        <span class="type">RiseOperation</span> <span class="variable">riseOperation</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RiseOperation</span>();</span><br><span class="line"></span><br><span class="line">        objectStructure.accept(gradeOperation, <span class="number">0</span>);</span><br><span class="line">        objectStructure.accept(gradeOperation, <span class="number">1</span>);</span><br><span class="line">        objectStructure.accept(gradeOperation, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        objectStructure.accept(weedOutOperation, <span class="number">3</span>);</span><br><span class="line">        objectStructure.accept(riseOperation, <span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220220205427.png" alt="image-20220220205425208" /></p>
<blockquote>
<p>对于扩展：</p>
<p>新的操作：如果由新的操作的话，只需要继承访问者就可以完成快速扩展了</p>
<p>新的元素：对于新的元素，每个访问者都要进行修改。如果要频繁的改动元素，那么说明访问者模式不适用这种情况</p>
</blockquote>
<h3 id="16）迭代器模式">16）迭代器模式</h3>
<p>迭代器模式，在集合中常用它进行遍历。它提供了一种方法给你用顺序去访问里面的元素，而不暴露里面的具体存数逻辑。里面可能是数组、链表或者二叉树，这些在外部看来不重要的细节，将被迭代器隐藏。</p>
<p>那么它是怎么被使用的呢，我们先来看一个<code>Iterator</code>接口。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> java.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.function.Consumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Iterator</span>&lt;E&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    E <span class="title function_">next</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>(<span class="string">&quot;remove&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">forEachRemaining</span><span class="params">(Consumer&lt;? <span class="built_in">super</span> E&gt; action)</span> &#123;</span><br><span class="line">        Objects.requireNonNull(action);</span><br><span class="line">        <span class="keyword">while</span> (hasNext())</span><br><span class="line">            action.accept(next());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接口定义的几个方法都很简单，我们主要实现这个接口，为一段元素创造一个迭代器，从而可以实现自己的迭代逻辑。</p>
<p>这边我举例书架上的书，我们将对书架上的书进行遍历。</p>
<p>先来看看迭代器模式中的一个成员角色吧</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><b>元素（Element）</b>：迭代器中的元素，对应上面例子就是书</p>
</li>
<li class="lvl-2">
<p><b>迭代器接口（Iterator）</b>：迭代器接口，我们使用jdk中的这个就好</p>
<ul class="lvl-2">
<li class="lvl-4"><b>迭代器实现类（IteratorImpl）</b>：对应上面元素，每一个元素都应该有自己的迭代器接口实现类</li>
</ul>
</li>
<li class="lvl-2">
<p><b>总计接口（Aggregate）</b>：一个总计的接口，里面将要有一系列元素的集合，不管这个集合你是怎么实现的。并且这个接口定义了<code>createIterator</code>方法，通过这个方法我们可以去创建对应的迭代器</p>
<ul class="lvl-2">
<li class="lvl-4"><b>总计实现</b>：实现类，对应上面例子就应该是书架，管理着书本。</li>
</ul>
</li>
</ul>
<p>我们先来个书本类，以及它具体的书本迭代器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.iterator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Book</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;《&quot;</span> + name + <span class="string">&quot;》&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.iterator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookIterator</span> <span class="keyword">implements</span> <span class="title class_">Iterator</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Book&gt; bookList;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> index;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BookIterator</span><span class="params">(List&lt;Book&gt; bookList)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(bookList, -<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bookList!=<span class="literal">null</span> &amp;&amp; bookList.size()&gt;index+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bookList.get(++index);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>定义一下<code>Aggregate</code>接口，它将是书架类的一个接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.iterator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Aggregate</span> &#123;</span><br><span class="line"></span><br><span class="line">    Iterator <span class="title function_">createIterator</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再来一个书架类，这里我们简单点，直接用<code>List</code>集合，真实的情况可能是自己写的节点内部类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.iterator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bookshelf</span> <span class="keyword">implements</span> <span class="title class_">Aggregate</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Book&gt; bookList;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Bookshelf</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.bookList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Iterator <span class="title function_">createIterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BookIterator</span>(bookList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>简单的迭代器就完成了，我们简单来测试一下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.iterator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IteratorMain</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Bookshelf</span> <span class="variable">bookshelf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Bookshelf</span>();</span><br><span class="line">        bookshelf.add(<span class="keyword">new</span> <span class="title class_">Book</span>(<span class="string">&quot;Java从入门到入土&quot;</span>));</span><br><span class="line">        bookshelf.add(<span class="keyword">new</span> <span class="title class_">Book</span>(<span class="string">&quot;Java虚拟机&quot;</span>));</span><br><span class="line">        bookshelf.add(<span class="keyword">new</span> <span class="title class_">Book</span>(<span class="string">&quot;Java内存模型&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">Iterator</span> <span class="variable">iterator</span> <span class="operator">=</span> bookshelf.createIterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext())&#123;</span><br><span class="line">            System.out.println(iterator.next());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220221223243.png" alt="image-20220221223239369" /></p>
<h3 id="17）观察者模式">17）观察者模式</h3>
<p>在现实生活中，我们常常会遇到一个对象改变从而影响其他对象的变化。这种类似于发布订阅的业务情况，我们可以使用观察者模式来进行解决。</p>
<p>简单举两个例子，</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>Excel表格中的数据和它对应的图表</p>
</li>
<li class="lvl-2">
<p>天气气象站和对应的天气网站</p>
</li>
</ul>
<p>观察者模式的特点是，一个对象与多个对象之间的联动，存在一对多的依赖关系，当这个对象有所改动，我们就该通知其他对象进行处理。所以，对应的几个角色关系是下面这样的</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><b>抽象主题（Subject）</b>：指的是那一个对象的抽象接口，它提供了一个用于保存观察者对象的聚集类和增加、删除观察者对象的方法，以及通知所有观察者的抽象方法。</p>
<ul class="lvl-2">
<li class="lvl-4"><b>具体主题（Concrete Subject）</b>：它将实现抽象目标中的通知方法，当具体主题的内部状态发生改变时，通知所有注册过的观察者对象。对应上面就是Excel中的数据</li>
</ul>
</li>
<li class="lvl-2">
<p><b>抽象观察者（Observer）</b>：它包含了一个更新自己的抽象方法，当接到具体主题的更改通知时被调用。</p>
<ul class="lvl-2">
<li class="lvl-4"><b>具体观察者（Concrete Observer）</b>：它将实现一个更新自己的一个操作方法，将在更改通知时被调用。对应上面例子就是Excel中的图表</li>
</ul>
</li>
</ul>
<p>用气象站和天气网站来进行举例，我们先写出两个接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.observer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Subject</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addObserver</span><span class="params">(Observer observer)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">removeObserver</span><span class="params">(Observer observer)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">notifyAllObserver</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.observer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(<span class="type">int</span> temperature, <span class="type">int</span> pressure, <span class="type">int</span> humidity)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">showData</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>提供一个具体的气象站</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.observer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WeatherBureau</span> <span class="keyword">implements</span> <span class="title class_">Subject</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> temperature;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> pressure;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> humidity;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Observer&gt; observerList;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WeatherBureau</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.observerList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setData</span><span class="params">(<span class="type">int</span> temperature, <span class="type">int</span> pressure, <span class="type">int</span> humidity)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;气象局天气数据更新&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.temperature = temperature;</span><br><span class="line">        <span class="built_in">this</span>.pressure = pressure;</span><br><span class="line">        <span class="built_in">this</span>.humidity = humidity;</span><br><span class="line">        <span class="comment">// 通知</span></span><br><span class="line">        notifyAllObserver();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addObserver</span><span class="params">(Observer observer)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.observerList.add(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeObserver</span><span class="params">(Observer observer)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.observerList.remove(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notifyAllObserver</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;正在通知所有观察者&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.observerList.forEach(item -&gt; item.update(<span class="built_in">this</span>.temperature, <span class="built_in">this</span>.pressure, <span class="built_in">this</span>.humidity));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再来两个具体的观察者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.observer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaiduWebsite</span> <span class="keyword">implements</span> <span class="title class_">Observer</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> temperature;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> pressure;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> humidity;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(<span class="type">int</span> temperature, <span class="type">int</span> pressure, <span class="type">int</span> humidity)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.temperature = temperature;</span><br><span class="line">        <span class="built_in">this</span>.pressure = pressure;</span><br><span class="line">        <span class="built_in">this</span>.humidity = humidity;</span><br><span class="line">        showData();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showData</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;********* 百度天气 *********&quot;</span>);</span><br><span class="line">        System.out.println(StrUtil.format(<span class="string">&quot;=== 温度：&#123;&#125; ===&quot;</span>, <span class="built_in">this</span>.temperature));</span><br><span class="line">        System.out.println(StrUtil.format(<span class="string">&quot;=== 气压：&#123;&#125; ===&quot;</span>, <span class="built_in">this</span>.pressure));</span><br><span class="line">        System.out.println(StrUtil.format(<span class="string">&quot;=== 湿度：&#123;&#125; ===&quot;</span>, <span class="built_in">this</span>.humidity));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.observer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SinaWebsite</span> <span class="keyword">implements</span> <span class="title class_">Observer</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> temperature;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> pressure;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> humidity;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(<span class="type">int</span> temperature, <span class="type">int</span> pressure, <span class="type">int</span> humidity)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.temperature = temperature;</span><br><span class="line">        <span class="built_in">this</span>.pressure = pressure;</span><br><span class="line">        <span class="built_in">this</span>.humidity = humidity;</span><br><span class="line">        showData();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showData</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;========== 新浪天气 ==========&quot;</span>);</span><br><span class="line">        System.out.println(StrUtil.format(<span class="string">&quot;~~~ 温度：&#123;&#125; ~~~&quot;</span>, <span class="built_in">this</span>.temperature));</span><br><span class="line">        System.out.println(StrUtil.format(<span class="string">&quot;~~~ 气压：&#123;&#125; ~~~&quot;</span>, <span class="built_in">this</span>.pressure));</span><br><span class="line">        System.out.println(StrUtil.format(<span class="string">&quot;~~~ 湿度：&#123;&#125; ~~~&quot;</span>, <span class="built_in">this</span>.humidity));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>写段代码来测试一下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.observer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ObserverMain</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">WeatherBureau</span> <span class="variable">weatherBureau</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WeatherBureau</span>();</span><br><span class="line">        weatherBureau.addObserver(<span class="keyword">new</span> <span class="title class_">BaiduWebsite</span>());</span><br><span class="line">        weatherBureau.addObserver(<span class="keyword">new</span> <span class="title class_">SinaWebsite</span>());</span><br><span class="line"></span><br><span class="line">        weatherBureau.setData(<span class="number">15</span>, <span class="number">3</span>, <span class="number">6</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220222214858.png" alt="image-20220222214857116" /></p>
<blockquote>
<p>观察者模式的缺点，一定得注意</p>
<ul class="lvl-1">
<li class="lvl-2">主题和观察者是通过抽象接口进行解耦，但没有完全解耦，所以可能会出现循环调用的情况，得注意。</li>
<li class="lvl-2">具体主题实现会有观察者的集合，当观察者过多时，通知会花费过大的时间，影响程序的效率</li>
</ul>
</blockquote>
<h3 id="18）中介模式">18）中介模式</h3>
<p>在生活中，我们常常会有需要中介的场景。如买房租房需要中介，国家间的贸易有了WTO组织进行贸易等等。中介模式就是这样，它将由一个中介类来管理一组对象，不让这些对象之间产生联系。</p>
<p>我们简单看看租房的这样一个例子吧，我想要找一个房子，距离地铁500米内，三楼，有阳台，且租金要少于2000元的租房。我只需要找中介就好，中介手里有好多这样的房子，如果需要一个一个的找房东，那不得麻烦死。</p>
<p>所以简单看看它们的角色</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><b>抽象中介（Mediator）</b>：定义了同事类的注册以及转发同事对象信息的抽象方法。</p>
</li>
<li class="lvl-2">
<p><b>具体中介（Concrete Mediator）</b>：实现中介者接口，定义一个集合来管理同事对象，用于协调调用具体同事对象。</p>
</li>
<li class="lvl-2">
<p><b>抽象同事（Colleague）</b>：同事类抽象出来的方法，将自己注册到中介中管理，实现所有相互影响的同事类的公共功能。</p>
</li>
<li class="lvl-2">
<p><b>具体同事（Concrete Colleague）</b>：具体的同事，里面有具体的属性及实现方法</p>
</li>
</ul>
<p>整活开始，先写一个房子类吧，里面有一些基本的信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.mediator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">House</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> floor;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> distance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> balcony;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> rent;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showInfo</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(StrUtil.format(<span class="string">&quot;租房信息【&#123;&#125;楼，距离地铁&#123;&#125;米，&#123;&#125;阳台，租金仅要&#123;&#125;元】&quot;</span>,</span><br><span class="line">                floor, distance, balcony? <span class="string">&quot;有&quot;</span>: <span class="string">&quot;没有&quot;</span>, rent));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再写出抽象层，抽象中介和抽象同事</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.mediator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractLandlord</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Mediator mediator;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;House&gt; houseList;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AbstractLandlord</span><span class="params">(String name, Mediator mediator)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.mediator = mediator;</span><br><span class="line">        <span class="built_in">this</span>.houseList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="built_in">this</span>.mediator.register(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.mediator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Mediator</span> &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;AbstractLandlord&gt; landlordList;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Mediator</span><span class="params">()</span> &#123;</span><br><span class="line">        landlordList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(AbstractLandlord landlord)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.landlordList.add(landlord);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">getMessage</span><span class="params">(AbstractLandlord landlord, <span class="type">int</span> type)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> House <span class="title function_">findHouse</span><span class="params">(<span class="type">int</span> floor, <span class="type">int</span> distance, <span class="type">boolean</span> balcony, <span class="type">int</span> rent)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>写出房东的两个具体同事类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.mediator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GoodLandlord</span> <span class="keyword">extends</span> <span class="title class_">AbstractLandlord</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">GoodLandlord</span><span class="params">(String name, Mediator mediator, House... houses)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name, mediator);</span><br><span class="line">        <span class="built_in">super</span>.setHouseList(Arrays.asList(houses));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        getMediator().getMessage(<span class="built_in">this</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.mediator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BadLandlord</span> <span class="keyword">extends</span> <span class="title class_">AbstractLandlord</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BadLandlord</span><span class="params">(String name, Mediator mediator, House... houses)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name, mediator);</span><br><span class="line">        <span class="built_in">super</span>.setHouseList(Arrays.asList(houses));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Mediator</span> <span class="variable">mediator</span> <span class="operator">=</span> getMediator();</span><br><span class="line">        mediator.getMessage(<span class="built_in">this</span>, <span class="number">1</span>);</span><br><span class="line">        mediator.getMessage(<span class="built_in">this</span>, <span class="number">2</span>);</span><br><span class="line">        mediator.getMessage(<span class="built_in">this</span>, <span class="number">3</span>);</span><br><span class="line">        mediator.getMessage(<span class="built_in">this</span>, <span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>中介要有一个具体的中介</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.mediator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteMediator</span> <span class="keyword">extends</span> <span class="title class_">Mediator</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">getMessage</span><span class="params">(AbstractLandlord landlord, <span class="type">int</span> type)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(type==<span class="number">1</span>)</span><br><span class="line">            showHouseInfo(landlord);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            System.out.println(landlord.getName() + <span class="string">&quot;，你TM哪来的这么多要求&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> House <span class="title function_">findHouse</span><span class="params">(<span class="type">int</span> floor, <span class="type">int</span> distance, <span class="type">boolean</span> balcony, <span class="type">int</span> rent)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (AbstractLandlord landlord : getLandlordList()) &#123;</span><br><span class="line">            List&lt;House&gt; houseList = landlord.getHouseList();</span><br><span class="line">            Optional&lt;House&gt; first = houseList.stream().filter(house -&gt; house.getFloor() == floor</span><br><span class="line">                    &amp;&amp; house.getDistance() &lt;= distance</span><br><span class="line">                    &amp;&amp; house.isBalcony() == balcony</span><br><span class="line">                    &amp;&amp; house.getRent() &lt;= rent).findFirst();</span><br><span class="line">            <span class="keyword">if</span>(first.isPresent())</span><br><span class="line">                <span class="keyword">return</span> first.get();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">showHouseInfo</span><span class="params">(AbstractLandlord landlord)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;========== &quot;</span>+ landlord.getName() +<span class="string">&quot;的房子 ==========&quot;</span>);</span><br><span class="line">        List&lt;House&gt; houses = landlord.getHouseList();</span><br><span class="line">        houses.forEach(House::showInfo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>万事俱备，只差调用，写段代码来测试一下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.mediator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MediatorMain</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ConcreteMediator</span> <span class="variable">mediator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteMediator</span>();</span><br><span class="line">        <span class="type">GoodLandlord</span> <span class="variable">goodLandlord</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GoodLandlord</span>(<span class="string">&quot;李四&quot;</span>, mediator,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">House</span>(<span class="number">3</span>, <span class="number">500</span>, <span class="literal">true</span>, <span class="number">1800</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">House</span>(<span class="number">6</span>, <span class="number">500</span>, <span class="literal">true</span>, <span class="number">2000</span>));</span><br><span class="line">        <span class="type">BadLandlord</span> <span class="variable">badLandlord</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadLandlord</span>(<span class="string">&quot;李四&quot;</span>, mediator,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">House</span>(<span class="number">3</span>, <span class="number">800</span>, <span class="literal">false</span>, <span class="number">2000</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">House</span>(<span class="number">6</span>, <span class="number">800</span>, <span class="literal">true</span>, <span class="number">2200</span>));</span><br><span class="line"></span><br><span class="line">        goodLandlord.sendMessage();</span><br><span class="line">        badLandlord.sendMessage();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;============== 分割线 ==============&quot;</span>);</span><br><span class="line">        <span class="comment">// 找一个距离地铁500米内，三楼，有阳台，且租金要少于2000元的租房</span></span><br><span class="line">        <span class="type">House</span> <span class="variable">house</span> <span class="operator">=</span> mediator.findHouse(<span class="number">3</span>, <span class="number">500</span>, <span class="literal">true</span>, <span class="number">2000</span>);</span><br><span class="line">        <span class="keyword">if</span>(house!=<span class="literal">null</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;找到了&quot;</span>);</span><br><span class="line">            house.showInfo();</span><br><span class="line">        &#125;<span class="keyword">else</span></span><br><span class="line">            System.out.println(<span class="string">&quot;可惜没有找到&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220223220652.png" alt="image-20220223220651200" /></p>
<blockquote>
<p>中介模式和外观模式的区别，它们两个真的好像</p>
<ul class="lvl-1">
<li class="lvl-2">中介模式：这几个同事类互相纠缠，互相调用，中介模式强调对它们进行解耦，都来找我吧。
<ul class="lvl-3">
<li class="lvl-4">上面例子不是特别好，用户和房东应该是同事类，用户去找中介应该是找房子，房东去找中介应该是放出房子信息</li>
<li class="lvl-4">如果电脑cpu，内存，主板，电源等要改成中介模式，那就是cpu，内存启动需要电源提供的电量，通过主板中介进行中转电量，嗯这样才对。</li>
</ul>
</li>
<li class="lvl-2">外观模式：外观模式强调的是对外提供统一的接口</li>
</ul>
</blockquote>
<h3 id="19）备忘录模式">19）备忘录模式</h3>
<p>在现实中，我们做错了事，那这件事就会一直存在，伴随着我们的一生。但在程序的世界中，我们并不是这样。</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>ctrl+c</code>撤销上一步操作</p>
</li>
<li class="lvl-2">
<p>单机游戏的存档功能点</p>
</li>
</ul>
<p>那么如此一个，可以支持撤销，回退到以前的状态的程序该如何进行设计呢。前人为我们总结出了备忘录模式。</p>
<p>备忘录模式：在不破坏对象的封装性的前提下，捕获一个对象的内部状态，并在对象之外保存这个状态。这样一来随时可以将对象恢复到原先保存的状态。备忘录模式常常与原型模式一同使用。</p>
<p>我们简单看看这个例子，即将挑战Boss的主角有三个属性，生命、攻击和防御。在进行挑战时，主角随时会有阵亡，而且还有其他的减攻击力和防御力的debuff效果。在挑战Boss前，将备份存档，如果主角出现意外，我们将恢复他的存档。</p>
<p>根据上面例子，看看备忘录模式需要哪些类进行完成</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><b>发起人（Originator）</b>：记录当前时刻的内部状态信息，提供创建备忘录和恢复备忘录数据的功能，实现其他业务功能，它可以访问备忘录里的所有信息。<mark>此角色将会有生命、攻击、防御三个属性</mark></p>
</li>
<li class="lvl-2">
<p><b>备忘录（Memento）</b>：负责存储发起人的内部状态，在需要的时候提供这些内部状态给发起人。<mark>此角色会保存住发起人需要保存的属性</mark></p>
</li>
<li class="lvl-2">
<p><b>管理者（Caretaker）</b>：对备忘录进行管理，提供保存与获取备忘录的功能，但其不能对备忘录的内容进行访问与修改。里面保存着每一个存档位，也就是备忘录</p>
</li>
</ul>
<p>根据上面角色，我们先写出有三个属性的发起人，它有生成备忘录和读取备忘录的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.memento;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Originator</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> hp;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> atk;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> def;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Memento <span class="title function_">createMemento</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Memento</span>(hp, atk, def);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showCurrentStatus</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(StrUtil.format(<span class="string">&quot;血量：&#123;&#125;，攻击力：&#123;&#125;，防御力：&#123;&#125;&quot;</span>, hp, atk, def));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">restoreMemento</span><span class="params">(Memento m)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setHp(m.getHp());</span><br><span class="line">        <span class="built_in">this</span>.setAtk(m.getAtk());</span><br><span class="line">        <span class="built_in">this</span>.setDef(m.getDef());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>备忘录，里面保存着发起人需要保存的属性信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.memento;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Memento</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> hp;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> atk;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> def;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>管理者，当然是备忘录的管理者啦，里面用数组管理者备忘录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.memento;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Caretaker</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Memento[] mementoArr = <span class="keyword">new</span> <span class="title class_">Memento</span>[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setMemento</span><span class="params">(<span class="type">int</span> i, Memento memento)</span>&#123;</span><br><span class="line">        mementoArr[i] = memento;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Memento <span class="title function_">getMemento</span><span class="params">(<span class="type">int</span> i)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mementoArr[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>好了，来测试一下吧</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.memento;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MementoMain</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Originator</span> <span class="variable">originator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Originator</span>(<span class="number">5000</span>, <span class="number">1226</span>, <span class="number">888</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;即将挑战Boss，先进行存档&quot;</span>);</span><br><span class="line">        Caretaker.setMemento(<span class="number">0</span>, originator.createMemento());</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;======= 挑战boss中 =======&quot;</span>);</span><br><span class="line">        originator.setHp(originator.getHp()/<span class="number">2</span>);</span><br><span class="line">        originator.setAtk((<span class="type">int</span>)(originator.getAtk()*<span class="number">1.5</span>));</span><br><span class="line">        originator.showCurrentStatus();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;======= 挑战boss中，我还能坚持 =======&quot;</span>);</span><br><span class="line">        originator.setHp(originator.getHp()/<span class="number">2</span>);</span><br><span class="line">        originator.setAtk(originator.getAtk()/<span class="number">5</span>);</span><br><span class="line">        originator.showCurrentStatus();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;======= 挑战boss中，有点难度，再存个档 =======&quot;</span>);</span><br><span class="line">        Caretaker.setMemento(<span class="number">1</span>, originator.createMemento());</span><br><span class="line">        originator.setHp(originator.getHp()/<span class="number">2</span>);</span><br><span class="line">        originator.setDef(originator.getDef()/<span class="number">5</span>);</span><br><span class="line">        originator.showCurrentStatus();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;======= 挑战boss中，不行啦，抓紧读档 =======&quot;</span>);</span><br><span class="line">        originator.restoreMemento(Caretaker.getMemento(<span class="number">0</span>));</span><br><span class="line">        originator.showCurrentStatus();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220224220116.png" alt="image-20220224220114715" /></p>
<h3 id="20）解释器模式">20）解释器模式</h3>
<p>解释器模式实现了一个表达式接口，该接口解释一个特定的上下文。这种模式被用在 SQL 解析、符号处理引擎、正则表达等。在平常项目中的使用不是特别大。</p>
<p>给定一个表达式，定义它的各种解释器。一般来说都有一个抽象的解释器，而它的子类会有许多实现，对每一个符号都有一个对应的解释器子类。</p>
<p>例如输入：<code>a+b-c</code></p>
<ul class="lvl-0">
<li class="lvl-2">
<p><b>AbstractExpression</b>：抽象的解释器，声明了一个解释方法</p>
</li>
<li class="lvl-2">
<p><b>TerminalExpression</b>：终结符解释器，会继承抽象解释器，实现表达式中最后终止的一个解释操作</p>
</li>
<li class="lvl-2">
<p><b>NoTerminalExpression</b>：非终结符解释器，同样会继承抽象解释器，实现表示式中的一个解释操作</p>
</li>
<li class="lvl-2">
<p><b>Context</b>：上下文环境，在这个环境中，我们将整合上面的表达式和它对应的每个解释器，以及一个解释的入口</p>
</li>
</ul>
<p>首先，一个顶级的抽象解释器，它定义了一个解释方法。这个解释方法的入参是具体的值<code>map</code>，假如表达式是<code>a+b</code>，那么这里将传入<code>&#123;a: 10, b: 20&#125;</code>这样的一个<code>map</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.interpreter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象解释器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Expression</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 解释方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">int</span> <span class="title function_">interpreter</span><span class="params">(Map&lt;String, Integer&gt; map)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再来一个值解释器，这是一个具体的解释器，用来解释表达式中的数字占位如表达式为<code>a+b</code>，它将解释<code>a</code>和<code>b</code>，将从<code>map</code>中将取出对应的数字值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.interpreter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 值解释器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ValueExpression</span> <span class="keyword">extends</span> <span class="title class_">Expression</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String key;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ValueExpression</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.key = key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 值解释器，将对应的值返回</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">interpreter</span><span class="params">(Map&lt;String, Integer&gt; map)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> map.get(key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>有了值解释器还不够，我们还要定义符号的解释器，准确来说是左右形式的符号解释器。</p>
<p>这个符号解释器是个抽象类，定义了左边的解释器和右边的解释器，在使用时将会传入值解释器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.interpreter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 符号解释器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">SymbolExpression</span> <span class="keyword">extends</span> <span class="title class_">Expression</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Expression left;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Expression right;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SymbolExpression</span><span class="params">(Expression left, Expression right)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.left = left;</span><br><span class="line">        <span class="built_in">this</span>.right = right;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">int</span> <span class="title function_">interpreter</span><span class="params">(Map&lt;String, Integer&gt; map)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>加法解释器，继承于符号解释器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.interpreter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddExpression</span> <span class="keyword">extends</span> <span class="title class_">SymbolExpression</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AddExpression</span><span class="params">(Expression left, Expression right)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(left, right);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">interpreter</span><span class="params">(Map&lt;String, Integer&gt; map)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.getLeft().interpreter(map) + <span class="built_in">super</span>.getRight().interpreter(map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>减法解释器，同样也是继承于符号解释器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.interpreter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SubtractExpression</span> <span class="keyword">extends</span> <span class="title class_">SymbolExpression</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SubtractExpression</span><span class="params">(Expression left, Expression right)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(left, right);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">interpreter</span><span class="params">(Map&lt;String, Integer&gt; map)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.getLeft().interpreter(map) - <span class="built_in">super</span>.getRight().interpreter(map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的几个解释器定义好了，如何使用？这时，我们将创建一个上下文环境的类来使用这些解释器。</p>
<p>上下文环境有点长，请耐心观看，必要时拉下来跑一跑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.interpreter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.convert.Convert;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Stack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Context</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String expStr;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Expression expression;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 构造函数，输入表达式，对表达式进行分析，得出对应的解释器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> expStr</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Context</span><span class="params">(String expStr)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建栈，一会分析表达式</span></span><br><span class="line">        Stack&lt;Expression&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// 分析表达式</span></span><br><span class="line">        <span class="type">char</span>[] charArr = expStr.toCharArray();</span><br><span class="line"></span><br><span class="line">        <span class="type">Expression</span> <span class="variable">left</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">Expression</span> <span class="variable">right</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; charArr.length; i++) &#123;</span><br><span class="line">            <span class="keyword">switch</span> (charArr[i])&#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">                    left = stack.pop();</span><br><span class="line">                    right = <span class="keyword">new</span> <span class="title class_">ValueExpression</span>(StrUtil.toString(charArr[++i]));</span><br><span class="line">                    stack.push(<span class="keyword">new</span> <span class="title class_">AddExpression</span>(left, right));</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">                    left = stack.pop();</span><br><span class="line">                    right = <span class="keyword">new</span> <span class="title class_">ValueExpression</span>(StrUtil.toString(charArr[++i]));</span><br><span class="line">                    stack.push(<span class="keyword">new</span> <span class="title class_">SubtractExpression</span>(left, right));</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    stack.push(<span class="keyword">new</span> <span class="title class_">ValueExpression</span>(StrUtil.toString(charArr[i])));</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.expression = stack.pop();</span><br><span class="line">        <span class="built_in">this</span>.expStr = expStr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 进行计算</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">count</span><span class="params">(Map&lt;String, Integer&gt; map)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="built_in">this</span>.expression.interpreter(map);</span><br><span class="line">        System.out.println(expStr + <span class="string">&quot;=&quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 快速创建表达式上下文</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Context <span class="title function_">createContext</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        System.out.print(<span class="string">&quot;请输入表达式：&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">expStr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(System.in)).readLine();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Context</span>(expStr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据当前的表单事，提供输入具体值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Integer&gt; <span class="title function_">setValMap</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        HashMap&lt;String, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> ch : expStr.toCharArray()) &#123;</span><br><span class="line">            <span class="keyword">if</span>((ch&gt;=<span class="string">&#x27;a&#x27;</span> &amp;&amp; ch&lt;=<span class="string">&#x27;z&#x27;</span>) || (ch&gt;=<span class="string">&#x27;A&#x27;</span> &amp;&amp; ch&lt;=<span class="string">&#x27;Z&#x27;</span>))&#123;</span><br><span class="line">                System.out.print(StrUtil.format(<span class="string">&quot;请输入&#123;&#125;的值：&quot;</span>, ch));</span><br><span class="line">                <span class="type">String</span> <span class="variable">number</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(System.in)).readLine();</span><br><span class="line">                map.put(StrUtil.toString(ch), Convert.toInt(number, <span class="number">0</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>事不宜迟，写段代码来测试一下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.interpreter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExpressionMain</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> Context.createContext();</span><br><span class="line">        Map&lt;String, Integer&gt; valMap = context.setValMap();</span><br><span class="line">        context.count(valMap);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过控制台写入表达式<code>a+b</code>，输入值<code>&#123;a: 10, b: 30&#125;</code>，查看结果</p>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220303212028.png" alt="image-20220303212025761" /></p>
<p>再来测试下减法，输入表达式<code>a+b-c</code>，输入值<code>&#123;a: 10, b: 10, c: 5&#125;</code></p>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220303212154.png" alt="image-20220303212152634" /></p>
<p>好的完成，个人认为这个一个最难的设计模式。它和表达式的解析概念高度融合，好在我们平常没有什么解析的需求存在。</p>
<h3 id="21）状态模式">21）状态模式</h3>
<p>在软件开发中，常常有对象有着不同的状态，而这些不同的状态往往会让对象执行不同的方法，如果使用<code>if</code>来判断的话。喂，这是谁写的代码，查看历史提交，好的吧，半年前的我。现在我可以使用状态模式来对这对象作出优化。</p>
<p>在现实生活中，人们常常会有各种状态，心情好心情差，兴奋度高或者兴奋度低之类的，有些事情只有你在特性的心情状态下才会去进行的。这种情况，我们就可以使用状态模式。</p>
<p>再比如游戏中，吃药，复活，探险是三个操作，而血量的状态却有满血、半血、空血等。</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>只有在半血的时候才能吃药</p>
</li>
<li class="lvl-2">
<p>只有不是空血状态的时候，才能进行探险</p>
</li>
<li class="lvl-2">
<p>只有在空血的时候，才能进行复活</p>
</li>
</ul>
<p>好的，上面的关系已经罗列出来了，来看看状态模式对这种情况会如何划分角色</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><b>状态抽象类（State）</b>：状态的抽象层，这里定义了一些操作，将由具体的实现类去实现</p>
<ul class="lvl-2">
<li class="lvl-4"><b>具体状态类（ConcreteState）</b>：具体的状态，它实现了上层抽象状态的一些操作方法</li>
</ul>
</li>
<li class="lvl-2">
<p><b>环境（Context）</b>：上下文环境，这个对象将持有状态，对状态进行更变。</p>
</li>
</ul>
<p>首先，状态抽象类先出，没什么问题</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.state;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractState</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> hp;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AbstractState</span><span class="params">(<span class="type">int</span> hp)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.hp = hp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">takeMedicine</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">resurrect</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">adventure</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>写出它的三个状态子类，注意这里关联了一个上下文环境类，也就是<code>Person</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.state;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 空血状态</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NoHpState</span> <span class="keyword">extends</span> <span class="title class_">AbstractState</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Person person;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">NoHpState</span><span class="params">(Person person)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="built_in">this</span>.person = person;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">takeMedicine</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;阵亡啦，当前状态不能吃药，快去复活&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">resurrect</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;正在返回出生点，请稍后&quot;</span>);</span><br><span class="line">        person.setState(<span class="keyword">new</span> <span class="title class_">FullHpState</span>(person));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">adventure</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;阵亡啦，当前状态不能探险，快去复活&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">package com.<span class="property">banmoon</span>.<span class="property">state</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 满血状态</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">FullHpState</span> <span class="keyword">extends</span> <span class="title class_ inherited__">AbstractState</span>&#123;</span><br><span class="line"></span><br><span class="line">    private <span class="title class_">Person</span> person;</span><br><span class="line"></span><br><span class="line">    public <span class="title class_">FullHpState</span>(<span class="title class_">Person</span> person) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(<span class="number">100</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">person</span> = person;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @<span class="title class_">Override</span></span><br><span class="line">    public <span class="keyword">void</span> <span class="title function_">takeMedicine</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;满血不能吃药&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @<span class="title class_">Override</span></span><br><span class="line">    public <span class="keyword">void</span> <span class="title function_">resurrect</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;还活着，你复活啥?&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @<span class="title class_">Override</span></span><br><span class="line">    public <span class="keyword">void</span> <span class="title function_">adventure</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Person</span>.<span class="title function_">adventure</span>(person);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.state;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 半血状态</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HalfHpState</span> <span class="keyword">extends</span> <span class="title class_">AbstractState</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Person person;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HalfHpState</span><span class="params">(Person person, <span class="type">int</span> hp)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(hp);</span><br><span class="line">        <span class="built_in">this</span>.person = person;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">takeMedicine</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;快吃药~&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="built_in">super</span>.getHp() + <span class="number">30</span>;</span><br><span class="line">        <span class="keyword">if</span>(i&gt;=<span class="number">100</span>)&#123;</span><br><span class="line">            person.setState(<span class="keyword">new</span> <span class="title class_">FullHpState</span>(person));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">resurrect</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;还活着，你复活啥?&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">adventure</span><span class="params">()</span> &#123;</span><br><span class="line">        Person.adventure(person);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateHp</span><span class="params">(<span class="type">int</span> hp)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.setHp(hp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面有关联的<code>Person</code>类再补上</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.state;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> AbstractState state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">()</span> &#123;</span><br><span class="line">        state = <span class="keyword">new</span> <span class="title class_">FullHpState</span>(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">takeMedicine</span><span class="params">()</span>&#123;</span><br><span class="line">        state.takeMedicine();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">resurrect</span><span class="params">()</span>&#123;</span><br><span class="line">        state.resurrect();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">adventure</span><span class="params">()</span>&#123;</span><br><span class="line">        state.adventure();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">adventure</span><span class="params">(Person person)</span>&#123;</span><br><span class="line">        <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;正在探险中~~~&quot;</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">hp</span> <span class="operator">=</span> person.getState().getHp() - random.nextInt(<span class="number">40</span>);</span><br><span class="line">            <span class="keyword">if</span>(hp&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;已阵亡，停止探险&quot;</span>);</span><br><span class="line">                person.setState(<span class="keyword">new</span> <span class="title class_">NoHpState</span>(person));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(hp&lt;<span class="number">100</span>)&#123;</span><br><span class="line">                <span class="type">AbstractState</span> <span class="variable">state</span> <span class="operator">=</span> person.getState();</span><br><span class="line">                <span class="keyword">if</span>(state <span class="keyword">instanceof</span> FullHpState)&#123;</span><br><span class="line">                    person.setState(<span class="keyword">new</span> <span class="title class_">HalfHpState</span>(person, hp));</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(state <span class="keyword">instanceof</span> HalfHpState)&#123;</span><br><span class="line">                    ((HalfHpState) state).updateHp(hp);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样基本的就写完了，简单来测试一下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.state;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StateMain</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">        <span class="comment">// 试试吃药</span></span><br><span class="line">        person.takeMedicine();</span><br><span class="line">        <span class="comment">// 试试复活</span></span><br><span class="line">        person.resurrect();</span><br><span class="line">        <span class="comment">// 试试探险</span></span><br><span class="line">        person.adventure();</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;========= 分割线 =========&quot;</span>);</span><br><span class="line">        <span class="comment">// 试试吃药</span></span><br><span class="line">        person.takeMedicine();</span><br><span class="line">        <span class="comment">// 试试复活</span></span><br><span class="line">        person.resurrect();</span><br><span class="line">        <span class="comment">// 试试探险</span></span><br><span class="line">        person.adventure();</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;========= 分割线 =========&quot;</span>);</span><br><span class="line">        <span class="comment">// 试试吃药</span></span><br><span class="line">        person.takeMedicine();</span><br><span class="line">        <span class="comment">// 试试复活</span></span><br><span class="line">        person.resurrect();</span><br><span class="line">        <span class="comment">// 试试探险</span></span><br><span class="line">        person.adventure();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220303230302.png" alt="image-20220303230301162" /></p>
<p>额，好像没有把<code>hp</code>打印出来，不能很直观的反应出状态。没事，效果也差不多。</p>
<h3 id="22）策略模式">22）策略模式</h3>
<p>在策略模式中，我们创建表示各种策略的对象和一个行为随着策略对象改变而改变的 context 对象。策略对象改变 context 对象的执行算法。</p>
<p>乍一听，什么都听不懂。诶，实际上它和我们的生活息息相关。</p>
<p>比如说，旅游的出行方式，我们可以选择坐高铁，可以选择坐飞机，这些不同的出行方式都是一种策略。</p>
<p>就根据上面的例子，查看下我们需要哪些角色</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><b>策略接口（Strategy）</b>：策略接口，定义了一个该策略的执行类</p>
<ul class="lvl-2">
<li class="lvl-4"><b>具体策略（ConcreteStrategy）</b>：具体策略，每一个具体的出行方式</li>
</ul>
</li>
<li class="lvl-2">
<p><b>上下文环境（Context）</b>：此上下文环境将会聚合策略</p>
</li>
</ul>
<p>话不多说，直接先来一个策略接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.strategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Strategy</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">trip</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>高铁策略</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.strategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GTrainStrategy</span> <span class="keyword">implements</span> <span class="title class_">Strategy</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">trip</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;高铁出行，就是快&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>飞机策略</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.strategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AirplaneStrategy</span> <span class="keyword">implements</span> <span class="title class_">Strategy</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">trip</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;飞机出行，我看行&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上下文环境，本次为<code>Person</code>，聚合了一个策略</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.strategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Strategy strategy;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(Strategy strategy)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.strategy = strategy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">travel</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;去旅行啦&quot;</span>);</span><br><span class="line">        packing();</span><br><span class="line">        strategy.trip();</span><br><span class="line">        play();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">packing</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;正在收拾行李&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">play</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;玩得好开心，旅游真好&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>写个客户端来测试一下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.strategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StrategyMain</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="keyword">new</span> <span class="title class_">AirplaneStrategy</span>());</span><br><span class="line">        person.travel();</span><br><span class="line">        System.out.println(<span class="string">&quot;========== 分割线 ==========&quot;</span>);</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="keyword">new</span> <span class="title class_">GTrainStrategy</span>());</span><br><span class="line">        person1.travel();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220305005754.png" alt="image-20220305005752380" /></p>
<p>策略模式在开发中特别常见，以前工作的时候做的一个小程序聊天，分别可以发送文字、图片、语音，这就是可以使用策略模式来进行优化。</p>
<p>再比如我这个博客后台系统，支持本地文件上传和OSS文件上传，这也是使用了策略模式。</p>
<h3 id="23）责任链模式">23）责任链模式</h3>
<p>在生活中，我们常常会遇到踢皮球的现象，到一个部门处理说这不是我负责了，踢到了另一个部门，其他部门也是如此。有些部门确实是没有处理事件的能力，但有些部门就是怕承担责任，秉着多一事不如少一事的原则，把我们当做皮球来回踢。搞得我们身心俱疲，想骂而又没有力气。</p>
<p>在程序中，我们为了避免这种事情的发生，客户端不需要清楚的知道该找谁，只需要将问题请求出去，处理类会进行处理，如果自己真的处理不了，那将会将请求丢给下一个处理类处理。而这是处理类内部责任划分，客户端是无感知的。</p>
<p>那么来举个例子，就比如说学生请假，<code>x</code>为请假天数</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>1&lt;=x&lt;=2</code>：班主任有权限，可以批准</p>
</li>
<li class="lvl-2">
<p><code>2&lt;x&lt;=7</code>：系主任有权限，可以批准</p>
</li>
<li class="lvl-2">
<p><code>7&lt;x&lt;=14</code>：副院长有权限，可以批准</p>
</li>
<li class="lvl-2">
<p><code>14&lt;x</code>：只能由院长进行批准</p>
</li>
</ul>
<p>要在以前，我绝对写一大堆的<code>if...else...</code>，但现在有了责任链模式，可以很方便的进行处理。</p>
<p>先来过一遍，责任链中的角色有哪些</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><b>抽象处理者（Handler）</b>：抽象类，定义了一个<code>handler</code>，表示责任链上下一个处理者，同时定义了一个处理的方法，将由子类去实现。</p>
</li>
<li class="lvl-2">
<p><b>具体处理者（ConcreteHandler）</b>：抽象处理者的子类，实现了处理请求的方法。同时此处，责任链上下一个具体处理者也已经完成。</p>
</li>
<li class="lvl-2">
<p><b>请求（Request）</b>：包含了请求的一些具体信息</p>
</li>
</ul>
<p>好的，我们先写出请求，包含了名字和请假天数两个属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.responsible;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeaveRequest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer number;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再写出一个抽象处理者，它主要持有一个责任链上下个处理者的对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.responsible;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Handler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Handler nextHandler;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">executeRequest</span><span class="params">(LeaveRequest request)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这一块我们倒着写，先写出院长，它不再有下一位处理者，所以为<code>null</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.responsible;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dean</span> <span class="keyword">extends</span> <span class="title class_">Handler</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Dean</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(<span class="string">&quot;院长&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">executeRequest</span><span class="params">(LeaveRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(request.getNumber()&gt;<span class="number">14</span>)</span><br><span class="line">            System.out.println(StrUtil.format(<span class="string">&quot;&#123;&#125;批准了&#123;&#125;同学的&#123;&#125;天请假条&quot;</span>, <span class="built_in">super</span>.getName(), request.getName(), request.getNumber()));</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            System.out.println(StrUtil.format(<span class="string">&quot;&#123;&#125;拒绝了&#123;&#125;同学的&#123;&#125;天请假&quot;</span>, <span class="built_in">super</span>.getName(), request.getName(), request.getNumber()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>副院长</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.responsible;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VicePresident</span> <span class="keyword">extends</span> <span class="title class_">Handler</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">VicePresident</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(<span class="string">&quot;副院长&quot;</span>, <span class="keyword">new</span> <span class="title class_">Dean</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">executeRequest</span><span class="params">(LeaveRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(request.getNumber()&lt;=<span class="number">14</span>)</span><br><span class="line">            System.out.println(StrUtil.format(<span class="string">&quot;&#123;&#125;批准了&#123;&#125;同学的&#123;&#125;天请假条&quot;</span>, <span class="built_in">super</span>.getName(), request.getName(), request.getNumber()));</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">super</span>.getNextHandler().executeRequest(request);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>系主任</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.responsible;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DepartmentHead</span> <span class="keyword">extends</span> <span class="title class_">Handler</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DepartmentHead</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(<span class="string">&quot;系主任&quot;</span>, <span class="keyword">new</span> <span class="title class_">VicePresident</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">executeRequest</span><span class="params">(LeaveRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(request.getNumber()&lt;=<span class="number">7</span>)</span><br><span class="line">            System.out.println(StrUtil.format(<span class="string">&quot;&#123;&#125;批准了&#123;&#125;同学的&#123;&#125;天请假条&quot;</span>, <span class="built_in">super</span>.getName(), request.getName(), request.getNumber()));</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">super</span>.getNextHandler().executeRequest(request);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>班主任</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.responsible;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassAdviser</span> <span class="keyword">extends</span> <span class="title class_">Handler</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ClassAdviser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(<span class="string">&quot;班主任&quot;</span>, <span class="keyword">new</span> <span class="title class_">DepartmentHead</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">executeRequest</span><span class="params">(LeaveRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(request.getNumber()&lt;=<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>();</span><br><span class="line">        <span class="keyword">if</span>(request.getNumber()&lt;=<span class="number">2</span>)</span><br><span class="line">            System.out.println(StrUtil.format(<span class="string">&quot;&#123;&#125;批准了&#123;&#125;同学的&#123;&#125;天请假条&quot;</span>, <span class="built_in">super</span>.getName(), request.getName(), request.getNumber()));</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">super</span>.getNextHandler().executeRequest(request);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>万事俱备，只差调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.banmoon.responsible;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResponsibleMain</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">LeaveRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LeaveRequest</span>(<span class="string">&quot;半月&quot;</span>, <span class="number">15</span>);</span><br><span class="line">        <span class="type">LeaveRequest</span> <span class="variable">request1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LeaveRequest</span>(<span class="string">&quot;九月&quot;</span>, <span class="number">5</span>);</span><br><span class="line">        <span class="type">ClassAdviser</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassAdviser</span>();</span><br><span class="line">        handler.executeRequest(request);</span><br><span class="line">        handler.executeRequest(request1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20220305105919.png" alt="image-20220305105917841" /></p>
<p>结果已经看到了，挺方便的一个模式。责任链模式被<code>springMVC</code>使用，就是拦截器。和本文示例有些差别，链路的顺序是由外部控制的，拦截器中优先级的设置。不像本章示例这样，在内部定死。</p>
<h2 id="六、最后想说的话">六、最后想说的话</h2>
<p>这些设计模式，以前只是零零散散的整理，但像这样一次性整理还是挺少的。也断断续续的从去年末整理到现在，不为别人而做的努力，只是让自己有个回顾的文章。</p>
<p>在程序方面，上面将的设计模式示例并不能生搬硬套解决问题，而是需要一定的融会贯通，将设计模式变种，融合来进行解决实际程序中的问题。</p>
<p>对比与框架中的源码，如果懂了设计模式，对于今后<mark>debug源码</mark>也会有很大的帮助。</p>
<p>本文参考：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1G4411c7N4?p=1">bilibili尚硅谷</a>、<a target="_blank" rel="noopener" href="http://c.biancheng.net/view/1317.html">C语言编程网</a>、<a target="_blank" rel="noopener" href="https://www.runoob.com/design-pattern/design-pattern-tutorial.html">菜鸟教程</a></p>
<p>想说的话就这些，与其共勉。</p>
<p>我是半月，祝你幸福！！！</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://www.banmoon.top">半月无霜</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://www.banmoon.top/archive/3c8916d6/">https://www.banmoon.top/archive/3c8916d6/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.banmoon.top" target="_blank">半月无霜</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="../../tags/demo/">demo</a></div><div class="post_share"><div class="social-share" data-image="https://banmoon-blog.oss-cn-guangzhou.aliyuncs.com/articles/4c8f1a51096c97b293c78bd3c8b57886.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="../5c70b7cf/" title="apply、call、bind函数的区别"><img class="cover" src="https://banmoon-blog.oss-cn-guangzhou.aliyuncs.com/articles/b65108a4d60d4028c047da36190fd9fc.jpg" onerror="onerror=null;src='../../img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">apply、call、bind函数的区别</div></div></a></div><div class="next-post pull-right"><a href="../31fa67a6/" title="windows强制删除被占用的文件"><img class="cover" src="https://banmoon-blog.oss-cn-guangzhou.aliyuncs.com/articles/4ac5cb52bac0e05e69b11a3af9c9bc7e.jpg" onerror="onerror=null;src='../../img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">windows强制删除被占用的文件</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="../ed3e62df/" title="JDK17的新特性写法"><img class="cover" src="https://banmoon-blog.oss-cn-guangzhou.aliyuncs.com/images/20231118221958.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-18</div><div class="title">JDK17的新特性写法</div></div></a></div><div><a href="../87c8a286/" title="Java8新特性stream流"><img class="cover" src="https://banmoon-blog.oss-cn-guangzhou.aliyuncs.com/articles/1d5e0e54087352483b8192f4a287cbc2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-27</div><div class="title">Java8新特性stream流</div></div></a></div><div><a href="../1fba55af/" title="SpringBootAdmin监控程序"><img class="cover" src="https://banmoon-blog.oss-cn-guangzhou.aliyuncs.com/images/20230925120045.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-09-25</div><div class="title">SpringBootAdmin监控程序</div></div></a></div><div><a href="../aeff03cf/" title="SpringBoot动态修改日志等级"><img class="cover" src="https://banmoon-pic.oss-cn-guangzhou.aliyuncs.com/images/20230304221526.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-04</div><div class="title">SpringBoot动态修改日志等级</div></div></a></div><div><a href="../a4ead5b7/" title="Validated分组校验及扩展"><img class="cover" src="https://banmoon-blog.oss-cn-guangzhou.aliyuncs.com/articles/b0efea5382ca20c31e4eb89502018d67.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-31</div><div class="title">Validated分组校验及扩展</div></div></a></div><div><a href="../2b62f472/" title="Valid注解使用及扩展"><img class="cover" src="https://banmoon-blog.oss-cn-guangzhou.aliyuncs.com/articles/6bf9e068b8dc3d11a2a7f07c50305abd.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-23</div><div class="title">Valid注解使用及扩展</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><!-- 这是侧边栏--><div class="aside-content" id="aside-content"><script>if (document.documentElement.classList.contains('hide-aside')) {
    saveToLocal.set('aside-status', 'show', 2);
    document.documentElement.classList.toggle('hide-aside');
}</script><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">设计模式详解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E4%BB%8B%E7%BB%8D"><span class="toc-text">一、介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%89GOF%EF%BC%88Gang-of-Four%EF%BC%89"><span class="toc-text">1）GOF（Gang of Four）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%89%E4%B8%83%E5%A4%A7%E5%8E%9F%E5%88%99"><span class="toc-text">2）七大原则</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1%EF%BC%89%E5%8D%95%E4%B8%80%E8%81%8C%E8%B4%A3%E5%8E%9F%E5%88%99"><span class="toc-text">2.1）单一职责原则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2%EF%BC%89%E6%8E%A5%E5%8F%A3%E9%9A%94%E7%A6%BB%E5%8E%9F%E5%88%99"><span class="toc-text">2.2）接口隔离原则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3%EF%BC%89%E4%BE%9D%E8%B5%96%E5%80%92%E8%BD%AC%E5%8E%9F%E5%88%99"><span class="toc-text">2.3）依赖倒转原则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4%EF%BC%89%E9%87%8C%E6%B0%8F%E6%9B%BF%E6%8D%A2%E5%8E%9F%E5%88%99"><span class="toc-text">2.4）里氏替换原则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5%EF%BC%89%E5%BC%80%E9%97%AD%E5%8E%9F%E5%88%99"><span class="toc-text">2.5）开闭原则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6%EF%BC%89%E8%BF%AA%E7%B1%B3%E7%89%B9%E5%8E%9F%E5%88%99"><span class="toc-text">2.6）迪米特原则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-7%EF%BC%89%E5%90%88%E6%88%90%E5%A4%8D%E7%94%A8%E5%8E%9F%E5%88%99"><span class="toc-text">2.7）合成复用原则</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%BB%8B%E7%BB%8D"><span class="toc-text">二、设计模式介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%88%9B%E5%BB%BA%E5%9E%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-text">三、创建型设计模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%89%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F"><span class="toc-text">1）单例模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1%EF%BC%89%E9%A5%BF%E6%B1%89%E5%BC%8F%EF%BC%88%E9%9D%99%E6%80%81%E5%B8%B8%E9%87%8F%EF%BC%89"><span class="toc-text">1.1）饿汉式（静态常量）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2%EF%BC%89%E9%A5%BF%E6%B1%89%E5%BC%8F%EF%BC%88%E9%9D%99%E6%80%81%E4%BB%A3%E7%A0%81%E5%9D%97%EF%BC%89"><span class="toc-text">1.2）饿汉式（静态代码块）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3%EF%BC%89%E6%87%92%E6%B1%89%E5%BC%8F%EF%BC%88%E7%BA%BF%E7%A8%8B%E4%B8%8D%E5%AE%89%E5%85%A8%EF%BC%89"><span class="toc-text">1.3）懒汉式（线程不安全）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4%EF%BC%89%E6%87%92%E6%B1%89%E5%BC%8F%EF%BC%88%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%EF%BC%8C%E5%90%8C%E6%AD%A5%E6%96%B9%E6%B3%95%EF%BC%89"><span class="toc-text">1.4）懒汉式（线程安全，同步方法）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5%EF%BC%89%E6%87%92%E6%B1%89%E5%BC%8F%EF%BC%88%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%EF%BC%8C%E5%90%8C%E6%AD%A5%E4%BB%A3%E7%A0%81%E5%9D%97%EF%BC%89"><span class="toc-text">1.5）懒汉式（线程安全，同步代码块）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-6%EF%BC%89%E5%8F%8C%E9%87%8D%E6%A3%80%E6%9F%A5"><span class="toc-text">1.6）双重检查</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-7%EF%BC%89%E9%9D%99%E6%80%81%E5%86%85%E9%83%A8%E7%B1%BB"><span class="toc-text">1.7）静态内部类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-8%EF%BC%89%E6%9E%9A%E4%B8%BE"><span class="toc-text">1.8）枚举</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%89%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-text">2）工厂模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1%EF%BC%89%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-text">2.1）简单工厂模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2%EF%BC%89%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F"><span class="toc-text">2.2）工厂方法模式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%89%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-text">3）抽象工厂模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%89%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-text">4）原型模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1%EF%BC%89%E6%B5%85%E6%8B%B7%E8%B4%9D"><span class="toc-text">4.1）浅拷贝</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2%EF%BC%89%E5%A5%97%E5%A8%83%E5%9E%8B%E6%B7%B1%E6%8B%B7%E8%B4%9D"><span class="toc-text">4.2）套娃型深拷贝</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3%EF%BC%89%E5%BA%8F%E5%88%97%E5%8C%96%E6%B7%B1%E6%8B%B7%E8%B4%9D"><span class="toc-text">4.3）序列化深拷贝</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4%EF%BC%89%E4%BD%BF%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9%E5%B7%A5%E5%85%B7%E5%8C%85"><span class="toc-text">4.4）使用第三方工具包</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%EF%BC%89%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-text">5）建造者模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1%EF%BC%89%E7%A4%BA%E4%BE%8B"><span class="toc-text">5.1）示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2%EF%BC%89%E7%AE%80%E5%8C%96%E4%B8%8E%E9%97%AE%E9%A2%98"><span class="toc-text">5.2）简化与问题</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E7%BB%93%E6%9E%84%E5%9E%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-text">四、结构型设计模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6%EF%BC%89%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-text">6）适配器模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1%EF%BC%89%E7%B1%BB%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-text">6.1）类适配器模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2%EF%BC%89%E5%AF%B9%E8%B1%A1%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-text">6.2）对象适配器模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3%EF%BC%89%E6%8E%A5%E5%8F%A3%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-text">6.3）接口适配器模式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%EF%BC%89%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F"><span class="toc-text">7）桥接模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%EF%BC%89%E8%A3%85%E9%A5%B0%E6%A8%A1%E5%BC%8F"><span class="toc-text">8）装饰模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1%EF%BC%89%E6%88%91%E7%9A%84%E8%AE%BE%E8%AE%A1"><span class="toc-text">8.1）我的设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2%EF%BC%89%E8%A3%85%E9%A5%B0%E6%A8%A1%E5%BC%8F%E5%AE%9E%E7%8E%B0"><span class="toc-text">8.2）装饰模式实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%EF%BC%89%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F"><span class="toc-text">9）组合模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10%EF%BC%89%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F"><span class="toc-text">10）外观模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11%EF%BC%89%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F"><span class="toc-text">11）享元模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12%EF%BC%89%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F"><span class="toc-text">12）代理模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#12-1%EF%BC%89%E9%9D%99%E6%80%81%E4%BB%A3%E7%90%86"><span class="toc-text">12.1）静态代理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-2%EF%BC%89%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E4%B9%8Bjdk%E4%BB%A3%E7%90%86"><span class="toc-text">12.2）动态代理之jdk代理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-3%EF%BC%89%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E4%B9%8BCglib%E4%BB%A3%E7%90%86"><span class="toc-text">12.3）动态代理之Cglib代理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E8%A1%8C%E4%B8%BA%E5%9E%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-text">五、行为型设计模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#13%EF%BC%89%E6%A8%A1%E6%9D%BF%E6%A8%A1%E5%BC%8F"><span class="toc-text">13）模板模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14%EF%BC%89%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F"><span class="toc-text">14）命令模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15%EF%BC%89%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-text">15）访问者模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#16%EF%BC%89%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-text">16）迭代器模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#17%EF%BC%89%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-text">17）观察者模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#18%EF%BC%89%E4%B8%AD%E4%BB%8B%E6%A8%A1%E5%BC%8F"><span class="toc-text">18）中介模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#19%EF%BC%89%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F"><span class="toc-text">19）备忘录模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#20%EF%BC%89%E8%A7%A3%E9%87%8A%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-text">20）解释器模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#21%EF%BC%89%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F"><span class="toc-text">21）状态模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22%EF%BC%89%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F"><span class="toc-text">22）策略模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#23%EF%BC%89%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F"><span class="toc-text">23）责任链模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E6%9C%80%E5%90%8E%E6%83%B3%E8%AF%B4%E7%9A%84%E8%AF%9D"><span class="toc-text">六、最后想说的话</span></a></li></ol></li></ol></div></div><script>var tocItems = document.querySelectorAll('.toc-item');
tocItems.forEach(item => {
  var span = item.querySelector('a > span');
  var content = span.textContent;
  item.setAttribute('title', content);
});</script><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="" title="如何读取到maven中profile设置的参数"><img src="https://banmoon-blog.oss-cn-guangzhou.aliyuncs.com/images/20240121131051.jpg" onerror="this.onerror=null;this.src='../../img/404.jpg'" alt="如何读取到maven中profile设置的参数"/></a><div class="content"><a class="title" href="" title="如何读取到maven中profile设置的参数">如何读取到maven中profile设置的参数</a><time datetime="2024-01-21T05:10:16.000Z" title="发表于 2024-01-21 13:10:16">2024-01-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="../ed3e62df/" title="JDK17的新特性写法"><img src="https://banmoon-blog.oss-cn-guangzhou.aliyuncs.com/images/20231118221958.jpg" onerror="this.onerror=null;this.src='../../img/404.jpg'" alt="JDK17的新特性写法"/></a><div class="content"><a class="title" href="../ed3e62df/" title="JDK17的新特性写法">JDK17的新特性写法</a><time datetime="2023-11-18T14:18:26.000Z" title="发表于 2023-11-18 22:18:26">2023-11-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="../4fdd3769/" title="MySQL插入重复后进行覆盖更新"><img src="https://banmoon-blog.oss-cn-guangzhou.aliyuncs.com/images/20231025162533.jpg" onerror="this.onerror=null;this.src='../../img/404.jpg'" alt="MySQL插入重复后进行覆盖更新"/></a><div class="content"><a class="title" href="../4fdd3769/" title="MySQL插入重复后进行覆盖更新">MySQL插入重复后进行覆盖更新</a><time datetime="2023-10-25T08:24:49.000Z" title="发表于 2023-10-25 16:24:49">2023-10-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="../2c73cf5f/" title="如何在html中使用Vue3"><img src="https://banmoon-blog.oss-cn-guangzhou.aliyuncs.com/images/20231013171018.jpg" onerror="this.onerror=null;this.src='../../img/404.jpg'" alt="如何在html中使用Vue3"/></a><div class="content"><a class="title" href="../2c73cf5f/" title="如何在html中使用Vue3">如何在html中使用Vue3</a><time datetime="2023-10-13T09:09:14.000Z" title="发表于 2023-10-13 17:09:14">2023-10-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="../1fba55af/" title="SpringBootAdmin监控程序"><img src="https://banmoon-blog.oss-cn-guangzhou.aliyuncs.com/images/20230925120045.jpg" onerror="this.onerror=null;this.src='../../img/404.jpg'" alt="SpringBootAdmin监控程序"/></a><div class="content"><a class="title" href="../1fba55af/" title="SpringBootAdmin监控程序">SpringBootAdmin监控程序</a><time datetime="2023-09-25T03:58:51.000Z" title="发表于 2023-09-25 11:58:51">2023-09-25</time></div></div></div></div></div></div></main><footer id="footer" style="background: linear-gradient(-45deg,#ee7752,#ce3e75,#23a6d5,#23d5ab)"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2024 By 半月无霜</div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/"><span>粤ICP备2021146613号</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="../../js/utils.js"></script><script src="../../js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="../../js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'https://www.banmoon.top/archive/3c8916d6/'
    this.page.identifier = ''
    this.page.title = 'Java设计模式详解'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }

  document.getElementById('darkmode').addEventListener('click', () => {
    setTimeout(() => window.disqusReset(), 200)
  })
}

if ('Valine' === 'Disqus' || !true) {
  if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script src="/js/banmoon.js" defer></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>